"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73356],{20771:(t,e,i)=>{i.d(e,{J:()=>o,e:()=>n});var a=i(647682),s=i(443331),r=i(307557);let o="published_data.json",n=async({itemId:t,authManager:e,portalHost:i,language:n,onlyReturnPublishedDataJsonResource:l,signal:h,timeStamp:d})=>{let u=e?void 0:(0,s.mZ)(i);try{let a=d?`?ts=${d}`:"";return await (0,r.aK)({itemId:t,resourceId:n?`published_data_${n}.json`:`${o}${a}`,portalHost:i,authManager:e,signal:h})}catch{if(!l)return await (0,a.MB)(t,{authentication:e,portal:u,signal:h})}}},44992:(t,e,i)=>{i.d(e,{CE:()=>r,sN:()=>o,uM:()=>n});var a=i(724875),s=i(301972);let r=t=>"expressmap"===t||"thematic-map-dataset"===t||"express-image-data"===t,o=(t,e,i)=>{let s=t&&("string"==typeof t.root||i===a.z.Collection||i===a.z.Theme)?n(t):n(),o=e&&("string"==typeof e.root||i===a.z.Collection||i===a.z.Theme)?n(e):n();return{itemResourcesToUnpublish:o.itemResources.filter(t=>-1===s.itemResources.findIndex(e=>e.id===t.id)),itemResourcesToPublish:s.itemResources.filter(t=>!!r(t.type)||-1===o.itemResources.findIndex(e=>e.id===t.id)),draftItemResources:s.itemResources,publishedItemResources:o.itemResources,relatedItems:s.itemRelationships.concat(o.itemRelationships)}},n=t=>{let e=[],i=[];return t&&Object.keys(t.resources??{}).forEach(a=>{let r=t.resources[a];"image"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"image"}):"image360"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"image360"}):"video"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"video"}):"audio"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"audio"}):"expressmap"===r.type&&l(r.data)?e.push({id:r.data.itemId,type:"expressmap"}):"thematic-map-dataset"===r.type?e.push({id:r.data.itemId,type:"thematic-map-dataset"}):"express-image-data"===r.type?e.push({id:r.data.itemId,type:"express-image-data"}):"file-item"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"file-item"}):"story-theme"===r.type&&r.data.themeItemId?i.push({type:s.wx,itemId:r.data.themeItemId}):"geo-data"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"geo-data"}):"json"===r.type&&"item-resource"===r.data.provider?e.push({id:r.data.resourceId,type:"json"}):"ai-metadata"===r.type&&"item-resource"===r.data.provider&&e.push({id:r.data.resourceId,type:"ai-metadata"})}),{itemResources:e,itemRelationships:i}},l=t=>void 0===t.provider&&!!t.itemId},124490:(t,e,i)=>{i.d(e,{S3:()=>l,U4:()=>o,Yn:()=>d,bH:()=>n,pe:()=>h,ul:()=>r});var a=i(850415),s=i(771543);let r=t=>`media-provider-tab-${t}`,o=t=>`media-provider-${t}`,n=t=>{if("image"===t.type)switch(t.data.provider){case"unsplash":return"unsplash";case"giphy":return"giphy";case"feature-attachment":case"uri":return"link";case"item-resource":return"upload";default:return}},l=(t,e)=>"error"!==t&&(e!==s.O2.Image||"photo"===t)&&(e!==s.O2.Video||"video"===t)&&(e!==s.O2.ImageOrVideo||"photo"===t||"video"===t),h=(t,e)=>{let i=new Set,a=t.concat(e),s=[];for(let t=0;t<a.length;t++){let e=a[t];i.has(e.id)||(s.push(e),i.add(e.id))}return s};function d(t,e,i){let r=[];switch(t){case s.O2.Image:r=[...a.gC,...e.SUPPORTED_CONVERTIBLE_IMAGE_MIME_TYPES];break;case s.O2.Image360:r=[...a.Wr];break;case s.O2.Audio:r=[...a.Ts,...e.SUPPORTED_CONVERTIBLE_AUDIO_MIME_TYPES];break;case s.O2.Video:r=[...a.ue,...e.SUPPORTED_CONVERTIBLE_VIDEO_MIME_TYPES];break;case s.O2.File:r=[...a.pp]}return r.reduce((t,e)=>i&&i.includes(e)?[...t]:[...t,e],[])}},153147:(t,e,i)=>{i.d(e,{g:()=>r,s:()=>s});var a=i(438304);let s=!0,r=(t,e)=>{let i=t.root();t.getAreSocialIconsHidden=()=>t.config.isSocialIconsHidden,t.setAreSocialIconsHidden=e=>{t.config.isSocialIconsHidden=e,t.update()},t.getShouldPushMetaToAGOItemDetails=()=>!1===t.getGlobalStates().featureDecisions.canAccessPortalApp||(t.config.shouldPushMetaToAGOItemDetails??s),t.resetMetaSettings=async()=>{t.data.metaSettings&&(delete t.data.metaSettings,await e.onReset?.(),t.emitMetaSettingsUpdate(),await t.update())},t.emitMetaSettingsUpdate=e=>{let a=e??t.getMetaSettings();i.emit("meta-settings-update",a)},t.getMetaSettings=()=>{let i=e.getMetaThumbnail();return{title:t.data.metaSettings?.title,description:t.data.metaSettings?.description,thumbnail:i}},t.updateMetaSettings=async e=>{e.shouldPushMetaToAGOItemDetails!==t.config.shouldPushMetaToAGOItemDetails&&(t.config.shouldPushMetaToAGOItemDetails=e.shouldPushMetaToAGOItemDetails,t.states.hasShouldPushMetaToAGOItemDetailsChanged=!0);let i={title:e.metaSettings.title??t.data.metaSettings?.title,description:e.metaSettings.description??t.data.metaSettings?.description,thumbnail:e.metaSettings.thumbnail};t.emitMetaSettingsUpdate(i);let s={title:i.title,description:i.description,imageResourceId:t.data.metaSettings?.imageResourceId};if(e.metaThumbnailForUpload){let i,{storyItem:r}=t.getGlobalStates();try{i=await (0,a.QM)({storyBuilder:r,data:e.metaThumbnailForUpload})}catch(e){t.getGlobalStates().toast.add({type:"error",title:t.getGlobalStates().getIntl().formatMessage({id:"builder.common.uploadError"})})}if(i){let e=await t.insertResource({data:{resourceId:i.resourceId,provider:"item-resource",type:"image",width:i.width,height:i.height},root:t,type:"image"});e&&(s.imageResourceId=e.id)}}t.data.metaSettings=s,await t.update()},t.getHaveMetaSettingsChanged=()=>void 0!==t.data.metaSettings?.title||void 0!==t.data.metaSettings?.description||void 0!==t.data.metaSettings?.imageResourceId,t.getMetaSettingsDataForSave=()=>{let e=t.root().do("getCoverData"),i=t.getShouldPushMetaToAGOItemDetails(),a={...!i?{title:e.title,description:e.snippet}:{},...t.data.metaSettings};return a.imageResourceId&&delete a.imageResourceId,{shouldPushMetaToAGOItemDetails:i,hasShouldPushMetaToAGOItemDetailsChanged:t.states.hasShouldPushMetaToAGOItemDetailsChanged,properties:{metaProperties:a}}},i.addEventListener("getMetaSettings",t.getMetaSettings),i.addEventListener("updateMetaSettings",t.updateMetaSettings),i.addEventListener("getHaveMetaSettingsChanged",t.getHaveMetaSettingsChanged),i.addEventListener("resetMetaSettings",t.resetMetaSettings),i.addEventListener("getShouldPushMetaToAGOItemDetails",t.getShouldPushMetaToAGOItemDetails),i.addEventListener("isSocialIconsHidden",t.getAreSocialIconsHidden),i.addEventListener("updateSocialIconsHiddenStatus",t.setAreSocialIconsHidden)}},167720:(t,e,i)=>{i.d(e,{E2:()=>h,Hv:()=>l,IQ:()=>d});var a=i(597481),s=i.n(a),r=i(307557),o=i(443331),n=i(550762);let l=({currentProps:t,newProps:e})=>s()({},t,e),h="DRAFT_DATA_RESOURCE",d=async({resourceName:t,itemId:e,itemOwner:i,authManager:a,portalHost:s})=>{let l,d=await (0,r.EY)({authManager:a,username:i,itemId:e,portal:(0,o.mZ)(s,a)});return l=t===h?(0,n.F4)(d)[0]:d.filter(e=>e.resource===t)[0],l?.properties&&JSON.parse(l?.properties)||null}},199065:(t,e,i)=>{i.d(e,{D:()=>s});var a=i(371065);class s extends Error{constructor(t){super(),this.name="StoryBuilderError";let{type:e,itemType:i}=t;this.type=this.message=e,this.itemType=i;let{statusCode:s}=(0,a.P)(this.type);this.statusCode=s}}},273356:(t,e,i)=>{i.d(e,{uB:()=>tE,YJ:()=>tv,Ay:()=>tT});var a=i(777011),s=i(805341),r=i(647682),o=i(307557),n=i(922658),l=i(9736),h=i(550762),d=i(167720),u=i(443331),c=i(20771),m=i(650557),p=i(724875),y=i(592391);let f=/screenshot-[A-Z]+-n-[A-Za-z0-9]{6}\.png/;var g=i(658600),S=i(301972);let b=async({authManager:t,itemId:e,mode:i,relationships:a,isSMXItemInAGSM:s})=>{let o={destinationItemId:e,authentication:t},n=[],l=(await (0,r.S9)({authentication:t,id:e,relationshipType:S.wx})).relatedItems.map(t=>t.id),h=a.reduce((t,e)=>e.type!==S.wx||l.includes(e.itemId)?t:t.concat(e),[]),d=[];l.forEach(t=>{a.find(e=>e.type===S.wx&&e.itemId===t)||d.push({itemId:t,type:S.wx})},[]),h.forEach(t=>{s&&"Theme2Story"===t.type||n.push((0,r.xg)({...o,originItemId:t.itemId,relationshipType:t.type}))}),d.forEach(t=>{s&&"Theme2Story"===t.type||n.push((0,r.y6)({...o,originItemId:t.itemId,relationshipType:t.type}))}),i===g.uB.DRAFT_SAVE||i===g.uB.DISCARDING_UNPUBLISHED_CHANGES?await Promise.allSettled(n):await Promise.all(n)};class A extends Error{constructor(t,e){super(e),this.resourceProperties=t}}var D=i(44992);let I=async({authManager:t,config:e,fallbackThumbnailUrl:i,isDataLossAllowed:a,itemId:s,itemResourcesEditInfo:h})=>{let d=await (0,r.Gq)(s,{authentication:t}),u=(0,o.Jc)({portalHost:e.PORTAL_HOST,itemDetails:d,fallbackUrl:i,shouldIgnoreDPR:!0,returnOriginalAspectRatio:!0,size:800}),c=await (0,n.vX)(u),{title:m,url:p="",byline:y}=d,f={version:"1.0",type:"rich",title:m,url:p,author_name:y,provider_name:`${e.PRODUCT_NAME}`,provider_url:new URL(p).origin,width:800,height:600,thumbnail_url:`${u}`,thumbnail_height:`${c.height}`,thumbnail_width:`${c.width}`,html:`<iframe src="${p}" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen></iframe>`,cache_age:86400},g=`<?xml version="1.0" encoding="utf-8" standalone="yes"?>
    <oembed>
      <version>1.0</version>
      <type>rich</type>
      <title>${m}</title>
      <url>${p}</url>
      <author_name>${y}</author_name>
      <provider_name>${e.PRODUCT_NAME}</provider_name>
      <provider_url>${new URL(p).origin}</provider_url>
      <width>800</width>
      <height>600</height>
      <thumbnail_url>${u}</thumbnail_url>
      <thumbnail_height>${c.height}</thumbnail_height>
      <thumbnail_width>${c.width}</thumbnail_width>
      <html><iframe src="${p}" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen="true"></iframe></html>
      <cache_age>86400</cache_age>
    </oembed>
    `;return await Promise.all([_({authManager:t,config:e,isDataLossAllowed:a,isPublished:!0,itemDetails:d,itemResourcesEditInfo:h,resourceName:"oembed.json",resource:(0,l.YX)(f)}),_({authManager:t,config:e,isDataLossAllowed:a,isPublished:!0,itemDetails:d,itemResourcesEditInfo:h,resourceName:"oembed.xml",resource:new Blob([g],{type:"text/xml"})})]),{xml:g,json:f}},_=async t=>{let e,i,a=t.authManager;if(!a)throw Error("no user session");let{id:o,owner:n}=t.itemDetails,{PORTAL_HOST:l}=t.config,u=(0,h.VG)(t.resourceName)?d.E2:t.resourceName,c=!t.resource&&!t.options?.params?.text&&!t.resourceProperties&&!t.options?.params?.properties;t.isRemove||u!==d.E2&&(t.isAdd||c)||(e=await (0,d.IQ)({resourceName:u,itemId:o,itemOwner:n,portalHost:l,authManager:a}),await P({authManager:a,config:t.config,itemDetails:t.itemDetails,isDataLossAllowed:t.isDataLossAllowed,resourceName:u,currentResourceProperties:e,itemResourcesEditInfo:t.itemResourcesEditInfo}));let m=r=>(i={editor:a.username,modified:Date.now(),id:(0,s.Ak)()},{...{authentication:a,id:o,name:t.resourceName,resource:t.resource,owner:n,private:!0!==t.isPublished},...t.options,...{params:{...t.options?.params,...r||!c?{properties:(0,d.Hv)({newProps:{...t.options?.params?.properties,...t.resourceProperties,editInfo:i},currentProps:e})}:{}}}});if(!0===t.isAdd){let e=await (0,r.zk)(m(!0));return await w({authManager:a,resourceName:u,editInfo:i,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e}if(!1===t.isAdd){let e=await (0,r.Fr)(m(!1));return await w({authManager:a,resourceName:u,editInfo:i,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e}if(!0===t.isRemove){let e=m(!1),s=await (0,r.at)({authentication:e.authentication,id:e.id,resource:e.name,owner:e.owner});return u!==d.E2&&await w({authManager:a,resourceName:u,editInfo:i,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo,removeTrackingInfo:!0}),s}try{let e=await (0,r.Fr)(m(!1));if(e.success)return await w({authManager:a,resourceName:u,editInfo:i,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e;throw e}catch(s){let e=await (0,r.zk)(m(!0));return await w({authManager:a,resourceName:u,editInfo:i,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e}},w=async({authManager:t,config:e,editInfo:i,itemDetails:a,removeTrackingInfo:s,resourceName:r,itemResourcesEditInfo:o})=>{if(s)return void delete o[r];let n=(0,h.VG)(r)?d.E2:r;if(i)o[n]=i;else{let i=await (0,d.IQ)({resourceName:n,itemId:a.id,authManager:t,portalHost:e.PORTAL_HOST,itemOwner:a.owner});o[n]=i?.editInfo}},P=async({authManager:t,config:e,currentResourceProperties:i,isDataLossAllowed:a,itemDetails:s,itemResourcesEditInfo:r,resourceName:o})=>{if(!a&&(o=o?(0,h.VG)(o)?d.E2:o:d.E2,i=i||await (0,d.IQ)({resourceName:o,itemId:s.id,itemOwner:s.owner,portalHost:e.PORTAL_HOST,authManager:t}),!f.test(o)&&i?.editInfo?.id&&r?.[o]?.id&&r?.[o]?.id!==i?.editInfo?.id))throw new A(i,"Data resource will be overwritten")},E=async({authManager:t,config:e,draftResourceId:i,mode:a,itemDetails:s,itemData:r,itemDraftData:n,isDataLossAllowed:l,isDuplicateCleanup:d,itemResourcesEditInfo:f,itemResourceIdsToKeep:S,type:A})=>{let I=a!==g.uB.DISCARDING_UNPUBLISHED_CHANGES?n:void 0,w=a===g.uB.UNPUBLISHING?void 0:r,P=(0,D.sN)(I,w,A),E=await (0,o.EY)({authManager:t,username:s.owner,itemId:s.id,portal:(0,u.mZ)(e.PORTAL_HOST,t)}),T=await v({authManager:t,config:e,itemId:s.id,resources:P.publishedItemResources,version:g.CN.PUBLISHED,mode:a}),C=await v({authManager:t,config:e,itemId:s.id,resources:P.draftItemResources,version:g.CN.DRAFT,mode:a}),O=d?{maxRetries:60,delay:5e3}:g.uB.DRAFT_SAVE?{maxRetries:0}:{},N=E.map(r=>{let n=r.resource;if(n===i||a===g.uB.DRAFT_SAVE&&(["oembed.json","oembed.xml",c.J].includes(n)||S?.has((0,o.Pn)(n))||!(0,h.VG)(n)&&Date.now()-864e5<r.created));else if(T.indexOf(n)>=0){if("inherit"!==r.access)return(0,m.O$)(_,{...O,promiseArguments:[{authManager:t,config:e,isAdd:!1,isPublished:!0,itemDetails:s,itemResourcesEditInfo:f,resourceName:n}]})}else if(!(C.indexOf(n)>=0))return(0,m.O$)(_,{...O,promiseArguments:[{authManager:t,config:e,isRemove:!0,itemDetails:s,itemResourcesEditInfo:f,resourceName:n}]});else if("private"!==r.access)return(0,m.O$)(_,{...O,promiseArguments:[{authManager:t,config:e,isAdd:!1,isPublished:!1,itemDetails:s,itemResourcesEditInfo:f,resourceName:n}]})}),M=await Promise.all(N);if(a===g.uB.PUBLISHING){let i=P.itemResourcesToPublish.map(i=>{if((0,D.CE)(i.type))return R({authManager:t,config:e,itemDetails:s,filename:i.id,source:g.CN.DRAFT,destination:g.CN.PUBLISHED,isDataLossAllowed:l,itemResourcesEditInfo:f})}),a=await Promise.all([...i]);M=M.concat(a)}else if(a===g.uB.DISCARDING_UNPUBLISHED_CHANGES){let i=P.publishedItemResources.map(i=>{if((0,D.CE)(i.type))return R({authManager:t,config:e,itemDetails:s,filename:i.id,source:g.CN.PUBLISHED,destination:g.CN.DRAFT,isDataLossAllowed:l,itemResourcesEditInfo:f})}),a=await Promise.all([...i]);M=M.concat(a)}return A!==p.z.Theme&&await b({authManager:t,itemId:s.id,relationships:P.relatedItems,mode:a,isSMXItemInAGSM:(0,y.c)(s)||(0,y.H)(s)}),M},v=async({resources:t,version:e,mode:i,itemId:a,authManager:s,config:r})=>{let n=[],l=t.map(t=>"expressmap"===t.type?(e===g.CN.PUBLISHED&&i===g.uB.PUBLISHING?n.push(T({authManager:s,config:r,itemId:a,expressMapId:t.id,version:g.CN.DRAFT})):e===g.CN.DRAFT&&i===g.uB.DISCARDING_UNPUBLISHED_CHANGES?n.push(T({authManager:s,config:r,itemId:a,expressMapId:t.id,version:g.CN.PUBLISHED})):n.push(T({authManager:s,config:r,itemId:a,expressMapId:t.id,version:e})),(0,o.sD)(t.id,e)):(0,D.CE)(t.type)?(0,o.sD)(t.id,e):t.id,[]);return(await Promise.all(n)).reduce((t,e)=>t.concat(e),l)},T=async({authManager:t,config:e,expressMapId:i,itemId:s,version:r})=>{let o=C({authManager:t,config:e,itemId:s,filename:i,version:r}),n=await (0,a.Em)(o,{authentication:t,httpMethod:"GET"});return Object.keys(n.popups).reduce((t,e)=>{let i=n.popups[e];return i.image&&"string"==typeof i.image?t.concat(i.image):t},[])},R=async({authManager:t,config:e,destination:i,filename:s,isDataLossAllowed:r,itemDetails:n,itemResourcesEditInfo:h,source:d})=>{let u=C({authManager:t,config:e,itemId:n.id,filename:s,version:d}),c=await (0,a.Em)(u,{authentication:t});return _({authManager:t,config:e,itemDetails:n,isDataLossAllowed:r,isPublished:i===g.CN.PUBLISHED,resourceName:(0,o.sD)(s,i),resource:(0,l.YX)(c),itemResourcesEditInfo:h})},C=({authManager:t,config:e,filename:i,itemId:a,version:s})=>`${(0,u.mZ)(e.PORTAL_HOST,t)}/content/items/${a}/resources/${(0,o.sD)(i,s)}`;var O=i(362420),N=i(831393),M=i(111970),L=i(95206);let k=Object.freeze({[p.z.Story]:L.A.Category.Story,[p.z.Collection]:L.A.Category.Collection,[p.z.Theme]:L.A.Category.Theme,[p.z.Briefing]:L.A.Category.Briefing,[p.z.Frame]:L.A.Category.Frame}),U={[p.z.Story]:L.A.Category.StoryTemplate},F=async({authManager:t,config:e,fallbackThumbnailUrl:i,isDataLossAllowed:a,itemResourcesEditInfo:s,itemDetails:n,sharingLevel:l,type:h})=>{let d=l.isUnlisted&&l.access===O.uQ.PUBLIC,u=await (0,o.L)({itemDetails:n,authManager:t}),c=await t.getUser(),m=[].concat(c.groups||[]).reduce((t,e)=>(t[e.id]=e,t),{}),y=c.favGroupId,f=(0,o.l$)(n,t),g=u.filter(t=>t!==y&&!l.groups?.includes(t)&&(0,N.I)({group:m[t],hasItemOwnerPermission:f,allowSharingToUpdateGroups:!0})),b=(l.groups??[]).filter(t=>t!==y&&!u?.includes(t)&&(0,N.I)({group:m[t],hasItemOwnerPermission:f,allowSharingToUpdateGroups:!0})),A=!1,D=n.typeKeywords?.includes(S.aE);d&&!D?(n.typeKeywords?.push(S.aE),A=!0):!d&&D&&(n.typeKeywords=n.typeKeywords?.filter(t=>t!==S.aE),A=!0);let _=(0,o.tD)(n),w=(0,M.WE)(n);!_&&(w||l.isViewerDuplicable)?(n.isViewerCopiable=!0,A=!0):!l.isViewerDuplicable&&_&&(n.isViewerCopiable=!1,A=!0);let P=n.typeKeywords?.includes(S.Sy);(l.isIndexable&&l.access===O.uQ.PUBLIC||l.access!==O.uQ.PUBLIC)&&P?(n.typeKeywords=n.typeKeywords?.filter(t=>t!==S.Sy),A=!0):l.access!==O.uQ.PUBLIC||l.isIndexable||P||(n.typeKeywords?.push(S.Sy),A=!0),A&&(await (0,r.fk)({authentication:t,item:n}),A=!1);let E=f?[(0,r.KP)({id:n.id,access:l.access===O.uQ.SHARED?O.uQ.PRIVATE:l.access,authentication:t,owner:n.owner})]:[],v=b.map(e=>(0,r.YG)({id:n.id,groupId:e,confirmItemControl:!0,authentication:t,owner:n.owner})),T=g.map(e=>(0,r.Bq)({id:n.id,groupId:e,authentication:t,owner:n.owner}));l.access===O.uQ.PUBLIC&&h!==p.z.Theme&&await I({authManager:t,config:e,fallbackThumbnailUrl:i,isDataLossAllowed:a,itemId:n.id,itemResourcesEditInfo:s});let R=w&&h===p.z.Story?U[h]:k[h];return L.A.trackEvent(R,L.A.Action.Story_ShareStory,l.isUnlisted?"unlisted":l.access),await Promise.all([...E,...v,...T])};var B=i(718230),$=i(501411);let G=async({appVersion:t,authManager:e,config:i,isDataLossAllowed:s,isDuplicateCleanup:o,itemData:n,itemDetails:h,itemDraftData:d,itemResourcesEditInfo:c,itemResourceIdsToKeep:m,mode:p,storeBackup:y,type:f})=>{let b=`draft_${Date.now()}.json`,A=h.typeKeywords?.filter(t=>!t.match(g.by.draft)&&t!==S.DD)??[];A.push(`${g.by.draft}:${t}`),h.typeKeywords=A,(({mode:t,itemDetails:e,itemDraftData:i})=>{if(t===g.uB.PUBLISHING||t===g.uB.UNPUBLISHING||(0,M.$l)(e)===B.hX.draft){if("object"==typeof i.nodes){let t=(()=>{for(let t of Object.values(i.nodes))if("tour"===t.type&&t.data?.type==="guided-tour")return!0;return!1})(),a=(e.typeKeywords??[]).filter(t=>t!==S.CS);t&&a.push(S.CS),e.typeKeywords=a}}})({mode:p,itemDetails:h,itemDraftData:d});try{y?.()}catch{}h.typeKeywords=(0,$.OM)({typeKeywords:h.typeKeywords,typeKeywordId:S.MZ}),h.typeKeywords=(0,$.d6)({typeKeywords:h.typeKeywords,typeKeywordId:S.Fc,data:b});let D=await _({authManager:e,itemDetails:h,config:i,isPublished:!1,isAdd:!0,isDataLossAllowed:s,itemResourcesEditInfo:c,resourceName:b,resource:(0,l.YX)(d)}),I=h.thumbnail instanceof Blob,w={...h};if(delete w.serviceProxyParams,await (0,a.Em)(`${(0,u.mZ)(i.PORTAL_HOST,e)}/content/users/${h.owner}/items/${h.id}/update
  `,{authentication:e,params:{...w,...I?{thumbnail:h.thumbnail}:{},text:p===g.uB.PUBLISHING||p===g.uB.UNPUBLISHING?n:void 0}}),I){let{thumbnail:t}=await (0,r.Gq)(h.id,{authentication:e});h.thumbnail=t}let P=await E({authManager:e,config:i,draftResourceId:b,isDataLossAllowed:s,isDuplicateCleanup:o,itemDetails:h,itemData:n,itemDraftData:d,itemResourcesEditInfo:c,itemResourceIdsToKeep:m,mode:p,type:f});return{draftData:D,itemDetails:h,updateResources:P,itemDraftData:d,itemData:n}},K=(t,e)=>[...e.filter(t=>t!==B.hX.draft&&t!==B.hX.published&&t!==B.hX.unpublishedChanges&&"status:draft"!==t&&"status:published"!==t&&"status:unpublished-changes"!==t),t];var H=i(725881),x=i(628762);let V=async({authManager:t,itemDetails:e,portalHost:i,itemDraftData:s,previousAllowedTranslations:r})=>{let o=(t=>{let{root:e,nodes:i}=t;if(!e||!i)return[];let a=i[e];return a.config?.allowedTranslations})(s),n=o&&o?.length>0,l=o?.filter(t=>{if(!r?.includes(t))return t}),h=r?.filter(t=>{if(!o?.includes(t))return t});if(l)try{let s=await (0,H.Lc)({filter:x.b.fetchAllPublicySharedPublishedStoriesByIds(l),authentication:t});await Promise.all(l.map(r=>{let o=`${g.cC.hasTranslation}:${e.id}`,n=s.results.find(t=>t.id===r),l=[...n?.typeKeywords??[],o];return(0,a.Em)(`${(0,u.mZ)(i,t)}/content/users/${e.owner}/items/${r}/update`,{authentication:t,params:{...n,typeKeywords:l}})}))}catch(t){console.error("Error linking translated items",t)}if(h)try{let s=await (0,H.Lc)({filter:x.b.fetchAllPublicySharedPublishedStoriesByIds(h),authentication:t});await Promise.all(h.map(r=>{let o=s.results.find(t=>t.id===r),n=o?.typeKeywords?.indexOf(`${g.cC.hasTranslation}:${e.id}`),l=o?.typeKeywords;return n&&l?.splice(n,1),(0,a.Em)(`${(0,u.mZ)(i,t)}/content/users/${e.owner}/items/${r}/update`,{authentication:t,params:{...o,typeKeywords:l}})}))}catch(t){console.error("Error unlinking translated items",t)}return!!n},z=async({appVersion:t,authManager:e,config:i,fallbackThumbnailUrl:a,isDataLossAllowed:s,isDuplicateCleanup:r,itemDetails:o,itemDraftData:n,itemResourcesEditInfo:h,sharingLevel:d,storeBackup:u,type:m,previousAllowedTranslations:p})=>{let y=await V({authManager:e,itemDetails:o,portalHost:i.PORTAL_HOST,itemDraftData:n,previousAllowedTranslations:p}),f=((t,e)=>{let{root:i,nodes:a}=t;if(!i||!a)return;let s=a[i],r=s.config?.shouldUnlink,o=e.typeKeywords?.find(t=>t.includes(g.cC.hasTranslation)?t:void 0);return s.config?.shouldUnlink&&r&&delete s.config.shouldUnlink,r?o:void 0})(n,o);o.typeKeywords=j(o,t,{hasTranslations:y,translationShouldUnlinkFromSource:f});let S=await G({appVersion:t,authManager:e,config:i,isDataLossAllowed:s,isDuplicateCleanup:r,itemDetails:o,itemData:n,itemDraftData:n,itemResourcesEditInfo:h,mode:g.uB.PUBLISHING,storeBackup:u,type:m}),b=await F({authManager:e,config:i,fallbackThumbnailUrl:a,itemDetails:o,isDataLossAllowed:s,itemResourcesEditInfo:h,sharingLevel:d,type:m}),A=await _({authManager:e,config:i,isAdd:!0,isDataLossAllowed:s,isPublished:!0,itemDetails:o,itemResourcesEditInfo:h,resourceName:c.J,resource:(0,l.YX)(n)});return{...S,serverItemData:A,shareItem:b}},j=(t,e,i)=>{let a=(0,$.Y)({typeKeywords:t.typeKeywords,typeKeywordId:g.cC.firstPublishedDate}),s=(0,$.Y)({typeKeywords:t.typeKeywords,typeKeywordId:g.cC.publishedDate}),r=(0,$.Y)({typeKeywords:t.typeKeywords,typeKeywordId:g.cC.hasTranslation}),o=Date.now(),n=t.typeKeywords?.filter(t=>!t.match(g.cC.publishedDate)&&!t.match(g.by.published)&&!t.match(S.lt))??[];if(n.push(`${g.cC.publishedDate}:${o}`),n.push(`${g.by.published}:${e}`),a||s||n.push(`${g.cC.firstPublishedDate}:${o}`),i.hasTranslations&&!r)n.push(g.cC.hasTranslation);else if(!i.hasTranslations&&r){let t=n.indexOf(g.cC.hasTranslation);n.splice(t,1)}if(i.translationShouldUnlinkFromSource){let t=n.indexOf(i.translationShouldUnlinkFromSource);n.splice(t,1)}return K(B.hX.published,n)},W=async t=>{let{authManager:e,config:i,fallbackThumbnailUrl:a,isDataLossAllowed:s,itemDetails:r,itemResourcesEditInfo:o,sharingLevel:n,type:l}=t;r.typeKeywords=Y(r);let h=await G({...t,itemData:{unpublished:!0},mode:g.uB.UNPUBLISHING}),d=await F({authManager:e,config:i,itemDetails:r,isDataLossAllowed:s,fallbackThumbnailUrl:a,sharingLevel:n,itemResourcesEditInfo:o,type:l});return{...h,shareItem:d}},Y=t=>{let e=t.typeKeywords?.filter(t=>!t.match(g.cC.publishedDate)&&!t.match(g.cC.firstPublishedDate)&&!t.match(g.by.published)&&!t.match("Copy Item")&&!t.match(S.hd))??[];return K(B.hX.draft,e)};var X=i(240300),q=i(671012),J=i(996622),Z=i(153147),Q=i(850415),tt=i(539423),te=i(986132),ti=i(771543),ta=i(199065),ts=i(249555),tr=i(52457),to=i(695807),tn=i(488310);let tl=Object.freeze({resource:"customTheme",order:"themeBasemap",media:"mediaBasemap",locale:"chineseBasemap",name:"basemapPicker",json:"jsonBasemap"}),th=async(t,e,i,s,o)=>{let n=Object.keys(e);await Promise.all(n.map(async n=>{if("expressmap"===e[n].type){let r=C({authManager:s,config:o,filename:e[n]?.data.itemId,itemId:i,version:"draft"}),l=await (0,a.Em)(r,{authentication:s,httpMethod:"GET"}),h=tl[l.basemap.type]||"unknownBasemap";L.A.trackEvent(t,L.A.Action.ExpressMap_PublishedExpressmapBaseMapType,h,0,"name"===l.basemap.type?e[n]?.data.value:void 0)}if("json"===e[n].type){let a=e[n].data.resourceId;if(a.startsWith("chart")){let e=await (0,r.ov)(i,{fileName:a,readAs:"json",authentication:s}),o=e.type,n=e.dataType;L.A.trackEvent(t,L.A.Action.Chart_PublishedChartType,o),L.A.trackEvent(t,L.A.Action.Chart_PublishedChartDataType,n,0)}}}))},td=t=>"string"==typeof t?t:"object"==typeof t?t.cols+"x"+t.rows:"unknown",tu=async t=>{try{let e=t.isTemplate?L.A.Category.StoryTemplate:({[p.z.Story]:L.A.Category.Story,[p.z.Frame]:L.A.Category.Frame,[p.z.Briefing]:L.A.Category.Briefing,[p.z.Collection]:L.A.Category.Collection,[p.z.Theme]:L.A.Category.Theme})[t.type],i=t.isTemplate?L.A.Category.StoryTemplateStatistics:({[p.z.Story]:L.A.Category.StoryStatistics,[p.z.Frame]:L.A.Category.FrameStatistics,[p.z.Briefing]:L.A.Category.BriefingStatistics,[p.z.Collection]:L.A.Category.CollectionStatistics,[p.z.Theme]:L.A.Category.ThemeStatistics})[t.type],a=t.isTemplate?L.A.Action.StoryTemplate_PublishTemplate:({[p.z.Story]:L.A.Action.Story_PublishStory,[p.z.Frame]:L.A.Action.Frame_PublishFrame,[p.z.Briefing]:L.A.Action.Briefing_PublishBriefing,[p.z.Collection]:L.A.Action.Collection_PublishCollection,[p.z.Theme]:L.A.Action.Theme_PublishTheme})[t.type];if((0,$.cW)({typeKeywords:t.itemDetails.typeKeywords??[],typeKeywordId:S.hd}).forEach(e=>{L.A.trackEvent(L.A.Category.Story,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_Topic:L.A.Action.StoryStatistics_Republish_Topic,e)}),L.A.trackEvent(e,a,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish),Object.keys(t.itemData.resources).forEach(i=>{let a=t.itemData.resources[i];if("story-theme"===a.type){let i=a.data.themeItemId??a.data.themeId;L.A.trackEvent(e,L.A.Action.GeneralStatistics_PublishedTheme,i,0,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}}),((t,e,i)=>{let a=(t=>{let e={giphy:0,unsplash:0,coverr:0};for(let i in t){let a=t[i].data.provider;("giphy"===a||"unsplash"===a||"coverr"===a)&&e[a]++}return e})(t);L.A.trackEvent(e,i,L.A.Name.UnsplashImage_PublishedStory_Count,a.unsplash),L.A.trackEvent(e,i,L.A.Name.GiphyImage_PublishedStory_Count,a.giphy),L.A.trackEvent(e,i,L.A.Name.CoverrVideo_PublishedStory_Count,a.coverr)})(t.itemData.resources,e,a),await th(i,t.itemData.resources,t.itemDetails.id,t.authManager,t.config),t.firstPublish){let i,{licenseType:a}=t;a||(a=""),i="SMX Item"===t.itemDetails.type||"SMX Theme"===t.itemDetails.type?"SMX":a.includes("creator")?L.A.Name.Story_PublishStory_UserType_Creator:a.includes("GISProfessional")?L.A.Name.Story_PublishStory_UserType_GISProfessional:a.includes("Storyteller")?L.A.Name.Story_PublishStory_UserType_StoryTeller:L.A.Name.Story_PublishStory_UserType_Public,L.A.trackEvent(e,L.A.Action.Story_PublishStory_UserType,i)}let s=new Date;if(t.firstPublish?L.A.trackEvent(i,L.A.Action.StoryStatistics_FirstPublish_DayOfMonth,s.getDate().toString()):L.A.trackEvent(i,L.A.Action.StoryStatistics_Republish_DayOfMonth,s.getDate().toString()),L.A.trackEvent(i,(0,o.tD)(t.itemDetails)?L.A.Action.ItemStatistics_AllowPublishedDuplicate:L.A.Action.ItemStatistics_DoNotAllowPublishedDuplicate,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish),L.A.trackEvent(i,(0,o.e5)({itemDetails:t.itemDetails,isTemplate:t.isTemplate})?L.A.Action.ItemStatistics_OptIntoSEO:L.A.Action.ItemStatistics_OptOutOfSEO,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish),"story"===t.type){let e={},a=0,s=0,r=0,o=0;Object.keys(t.itemData.nodes).forEach(n=>{let l=t.itemData.nodes[n];if("immersive-slide"!==l.type&&"immersive-side-panel"!==l.type){if("immersive"===l.type){let t=l.data.type;"sidecar"===t&&(t="floating-panel"===l.data.subtype?"sidecar-float":"docked-panel"===l.data.subtype?"sidecar-docked":"sidecare-slideshow"),l.type=t}else"gallery"===l.type&&(l.type="square-dynamic"===l.data.galleryLayout?"gallery-square-dynamic":"jigsaw"===l.data.galleryLayout?"gallery-jigsaw":"gallery-filmstrip");if("number"==typeof e[l.type]?e[l.type]=e[l.type]+1:e[l.type]=1,("image"===l.type||"video"===l.type||"audio"===l.type||"embed"===l.type||"expressmap"===l.type||"thematic-map"===l.type||"webmap"===l.type||"swipe"===l.type)&&(s+=1,l.data?.alt?.length>0&&(r+=1)),"video"===l.type&&(l.data?.closedCaption&&(a+=1),l.data?.transcript&&(o+=1)),"large-number"===l.type&&(L.A.trackEvent(i,L.A.Action.StoryStatistics_LargeNumberIconPosition,l.data?.iconPosition||"default",0,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish),L.A.trackEvent(i,l.type+L.A.Action.StoryStatistics_CustomIconType,l.data?.icon||"default",0,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)),l.data&&("slideshow"===l.type||"sidecar-float"===l.type||"sidecar-docked"===l.type)&&(l.data.type,L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_SideCar_FirstPublish_SlidesCount:L.A.Action.StoryStatistics_SideCar_Republish_SlidesCount,L.A.Name.Builder_Sidecar,l.children?l.children.length:0)),"table"===l.type&&l.data){let{numRows:e,numColumns:a}=l.data;L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_Table_FirstPublish_NumRows:L.A.Action.StoryStatistics_Table_Republish_NumRows,L.A.Name.Builder_Table,e),L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_Table_FirstPublish_NumColumns:L.A.Action.StoryStatistics_Table_Republish_NumColumns,L.A.Name.Builder_Table,a)}if("grid"===l.type&&l.children&&l.children.length>0){let e=l.children.length,a=t.itemData.nodes[l.children[0]].type;L.A.trackEvent(i,L.A.Action.StoryStatistics_GridChildBlockType_Count,a,e,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}if("tour"===l.type&&l.data){let e="explorer"===l.data.type;L.A.trackEvent(i,t.firstPublish?e?L.A.Action.StoryStatistics_Explorer_FirstPublish_SlidesCount:L.A.Action.StoryStatistics_GuidedTour_FirstPublish_SlidesCount:e?L.A.Action.StoryStatistics_Explorer_Republish_SlidesCount:L.A.Action.StoryStatistics_GuidedTour_Republish_SlidesCount,e?L.A.Name.Builder_Explorer:L.A.Name.Builder_GuidedTour,l.data.places?l.data.places.length:0);let a="",s=!1;switch(l.data.subtype){case"map-focused":a="Map_Focused";break;case"media-focused":a="Media_Focused";break;case"list":a="List";break;case"grid":a="Grid";break;case"categorized":a="Categorized_List",s=!0;break;case"categorized-grid":a="Categorized_Grid",s=!0}s&&((t,e,i)=>{e.data?.categories&&e.data.categories.forEach(a=>{L.A.trackEvent(t,e.type+L.A.Action.StoryStatistics_CustomIconType,a.icon||"default",0,i.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)})})(i,l,t),L.A.trackEvent(i,e?L.A.Action.StoryStatistics_Explorer_Layout:L.A.Action.StoryStatistics_GuidedTour_Layout,a)}if("credits"===l.type&&l.config&&!l.config.isHidden&&L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_CreditsToggledOn:L.A.Action.StoryStatistics_Republish_CreditsToggledOn),"story"===l.type){if(l.config?.storyLocale&&L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_StoryLocale:L.A.Action.StoryStatistics_Republish_StoryLocale,l.config.storyLocale),l.config?.analytics){let e=l.config.analytics.type;L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_AuthorAnalytics:L.A.Action.StoryStatistics_Republish_AuthorAnalytics,e)}l.config?.isSocialIconsHidden&&L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_HideSocialShare:L.A.Action.StoryStatistics_Republish_HideSocialShare),L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_CoverDate:L.A.Action.StoryStatistics_Republish_CoverDate,l.config?.coverDate),a>0&&L.A.trackEvent(i,L.A.Action.GeneralStatistics_PublishedWithVideoClosedCaption,a.toString(),0,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish),o>0&&L.A.trackEvent(i,L.A.Action.GeneralStatistics_PublishedWithVideoTranscript,o.toString(),0,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}}});let n=t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_NodeCount:L.A.Action.StoryStatistics_Republish_NodeCount;Object.keys(e).forEach(t=>{L.A.trackEvent(i,n,t,e[t])});let l=t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_AltTextUsed:L.A.Action.StoryStatistics_Republish_AltTextUsed,h=s>0&&r>0,d=Math.round(r/s*100);L.A.trackEvent(i,l,h.toString(),d)}if(t.type===p.z.Theme){let{resources:e,titleFont:a,bodyFont:s,variables:r}=t.itemData,o={title:{action:t.firstPublish?L.A.Action.ThemeStatistics_FirstPublish_TitleFont:L.A.Action.ThemeStatistics_Republish_TitleFont,themeVariablesFontId:r.titleFontId},body:{action:t.firstPublish?L.A.Action.ThemeStatistics_FirstPublish_BodyFont:L.A.Action.ThemeStatistics_Republish_BodyFont,themeVariablesFontId:r.bodyFontId}};(a=>{let s={google:0};a.forEach(t=>{let{type:a,data:r}=t,n=o[a];if((0,tn.dE)(n.themeVariablesFontId))return void L.A.trackEvent(i,n.action,to.n9[n.themeVariablesFontId].displayName);if(!r)return;let l=e?.[r.resource]?.data;l&&(s[l.provider]=(s[l.provider]||0)+1,L.A.trackEvent(i,n.action,l.displayName))}),s.google&&L.A.trackEvent(i,t.firstPublish?L.A.Action.ThemeStatistics_FirstPublish_UsedGoogleFonts:L.A.Action.ThemeStatistics_Republish_UsedGoogleFonts)})([{type:"title",data:a},{type:"body",data:s}])}if(t.type===p.z.Collection){let e=!1;Object.keys(t.itemData.nodes).forEach(a=>{let s=t.itemData.nodes[a];if("collection-cover"===s.type){e=("object"==typeof s.data&&"mapOptions"in s.data?s.data.mapOptions:{}).isEnabled;let a=s.children?s.children?.reduce((e,i)=>{let a=t.itemData.nodes[i];if("text"===a.type){let t=a.data.text,i=(0,tr.wr)(t??"");return{nodeCount:e.nodeCount+1,characterCount:e.characterCount+i.length}}return e},{nodeCount:0,characterCount:0}):{nodeCount:0,characterCount:0};L.A.trackEvent(i,L.A.Action.Collection_Description_TextBlocks,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,a?.nodeCount),L.A.trackEvent(i,L.A.Action.Collection_Description_CharacterCount,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,a?.characterCount)}if("collection-map"===s.type){let e="object"==typeof s.data&&"geometries"in s.data?Object.keys(s.data.geometries).length:0;L.A.trackEvent(i,L.A.Action.Collection_LocationCount,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,e)}}),L.A.trackEvent(i,L.A.Action.CollectionPublishedWithMap,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,0,e?"true":"false")}if("frame"===t.type){let e={},a={},s={},r={},o={},n={};Object.keys(t.itemData.nodes).forEach(l=>{let h=t.itemData.nodes[l];if(e[h.type]=(e[h.type]??0)+1,"frame"===h.type){let e=h.data;L.A.trackEvent(i,L.A.Action.FrameStatistics_ViewerBackgroundType,e.viewerBackground,0,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}if("frame-slide"===h.type){let t=h.data,e=t.sublayout?t.layout+":"+td(t.sublayout):t.layout;a[e]=(a[e]??0)+1}if("storycover"===h.type&&h.children){let e=h.children[0],a=t.itemData.nodes[e].type;L.A.trackEvent(i,L.A.Action.FrameStatistics_CoverMediaType,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,0,a)}if("embed"===h.type){let e=h.data,a=e.embedType??"embed";r[a]=(r[a]??0)+1,L.A.trackEvent(i,L.A.Action.FrameStatistics_Url,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,0,e.url)}if("text"===h.type){let t=h.data.type;s[t]=(s[t]??0)+1}if("image"===h.type||"video"===h.type){let t=h.type,e=h.config&&h.config?.placement?h.config.placement.type:"fill";"image"===t&&(o[e]=(o[e]??0)+1),"video"===t&&(n[e]=(n[e]??0)+1)}}),Object.keys(e).forEach(a=>{L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_NodeCount:L.A.Action.StoryStatistics_Republish_NodeCount,a,e[a])}),Object.keys(a).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedSlideLayoutCount,e,a[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(s).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedTextTypeCount,e,s[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(r).forEach(e=>{L.A.trackEvent(i,L.A.Action.FrameStatistics_EmbedType,e,r[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(o).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedImagePlacementCount,e,o[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(n).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedVideoPlacementCount,e,n[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)})}if("briefing"===t.type){let e={},a={},s={},r={},o={},n={},l=0;Object.keys(t.itemData.nodes).forEach(s=>{let h=t.itemData.nodes[s];if(e[h.type]=e[h.type]+1||1,"briefing-slide"===h.type){let e=h.data.sublayout?h.data.layout+":"+td(h.data.sublayout):h.data.layout;if(a[e]=a[e]+1||1,h.data.title){let e=t.itemData.nodes[h.data.title],a=e?.data?.text.length;L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedSlideTitleLength,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,a)}}if("storycover"===h.type&&h.children){let e=h.children[0],a=t.itemData.nodes[e].type;L.A.trackEvent(i,L.A.Action.BriefingStatistics_CoverMediaType,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,0,a)}if("image"===h.type||"video"===h.type){let t=h.type,e=h.config&&h.config?.placement?h.config.placement.type:"fill";"image"===t&&(r[e]=r[e]+1||1),"video"===t&&(o[e]=o[e]+1||1,"object"==typeof h.data&&"closedCaption"in h.data&&(l+=1))}("webmap"===h.type||"expressmap"===h.type||"embed"===h.type)&&((e,i)=>{if(!e.dependents?.offline)return;let a="string"==typeof e.dependents.offline?e.dependents.offline:e.dependents.offline[0],s=t.itemData.nodes[a].type;i[e.type]?i[e.type][s]=i[e.type][s]+1||1:i[e.type]={[s]:1}})(h,n)}),Object.keys(e).forEach(a=>{L.A.trackEvent(i,t.firstPublish?L.A.Action.StoryStatistics_FirstPublish_NodeCount:L.A.Action.StoryStatistics_Republish_NodeCount,a,e[a])}),Object.keys(a).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedSlideLayoutCount,e,a[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(a=>{L.A.trackEvent(i,L.A.Action.StoryStatistics_OfflineMediaUsedBy+e,L.A.Name.OfflineMedia_Type+a,n[e][a],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)})}),Object.keys(s).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedTextTypeCount,e,s[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(r).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedImagePlacementCount,e,r[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),Object.keys(o).forEach(e=>{L.A.trackEvent(i,L.A.Action.BriefingStatistics_PublishedVideoPlacementCount,e,o[e],t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish)}),l>0&&L.A.trackEvent(i,L.A.Action.GeneralStatistics_PublishedWithVideoClosedCaption,t.firstPublish?L.A.Name.Story_PublishStory_FromDraft:L.A.Name.Story_PublishStory_Republish,l)}}catch{return}};async function tc(t){try{if(!(0,ti.f7)(t.itemData))return;return tu({...t,...window.structuredClone({itemData:t.itemData,itemDetails:t.itemDetails})})}catch{}}var tm=i(128456),tp=i(155696);function ty(t){return"story"===t.type||"collection"===t.type||"briefing"===t.type}function tf(t){return["storycover","collection-cover"].includes(t.type)}var tg=i(224409);let tS=async({type:t,itemDetails:e,itemProperties:i,thumbnail:a,baseUrl:s,authManager:r,portalHost:o,shouldPushMetaToAGOItemDetails:l,shouldForceUpdateThumbnail:h})=>{if(t===p.z.Story||t===p.z.Collection||t===p.z.Briefing){let t=(0,q.T)(e),d=JSON.stringify(t?.thumbnail??null),u=JSON.stringify(i?.thumbnail??null),c=i?.thumbnail?.[0]==="generated",m=!!(c&&a instanceof Blob)||d!==u&&"null"!==d;if("null"===u&&(i={...i,thumbnail:["default"]}),!m&&!h&&(e.thumbnailUrl||e.thumbnail instanceof Blob)&&(delete e.thumbnailUrl,delete e.thumbnail),m||h){if(a instanceof Blob&&(e.thumbnail=a),!l)return;if(!c){let t=e.thumbnailUrl?await (0,n.$n)((0,tg.Y2)(e.thumbnailUrl,{width:3e3,authManager:r,shouldIgnoreDPR:!0,portalHost:o}),{aspectRatio:1.5,zoom:5,quality:.8,type:"image/jpeg"}):await (0,tm.q_)(s);e.thumbnail=t}delete e.thumbnailUrl}}else void 0===a&&e.thumbnail instanceof Blob?delete e.thumbnail:a&&(e.thumbnail=a)};var tb=i(377888),tA=i(811579),tD=i(345081);let tI=t=>`smdraftrecovery_${t}`,t_=t=>{let e=tI(t);return JSON.parse(window.localStorage.getItem(e))},tw=Object.freeze({[p.z.Story]:L.A.Action.Story_UnpublishStory,[p.z.Collection]:L.A.Action.Collection_UnpublishCollection,[p.z.Theme]:L.A.Action.Theme_UnpublishTheme,[p.z.Briefing]:L.A.Action.Briefing_UnpublishBriefing,[p.z.Frame]:L.A.Action.Frame_UnpublishFrame}),tP=Object.freeze({[p.z.Story]:L.A.Action.Story_DuplicateStory,[p.z.Collection]:L.A.Action.Collection_DuplicateCollection,[p.z.Theme]:L.A.Action.Theme_DuplicateTheme,[p.z.Briefing]:L.A.Action.Briefing_DuplicateBriefing,[p.z.Frame]:L.A.Action.Frame_DuplicateFrame});var tE=function(t){return t[t.DRAFT_SAVE=0]="DRAFT_SAVE",t[t.PUBLISHING=1]="PUBLISHING",t[t.UNPUBLISHING=2]="UNPUBLISHING",t[t.DISCARDING_UNPUBLISHED_CHANGES=3]="DISCARDING_UNPUBLISHED_CHANGES",t}({});class tv extends tD.${static{this.fetchItemDraftData=async t=>{try{let e=await (0,h.hB)({itemDetails:t.itemDetails,portalHost:t.portalHost,authManager:t.authManager});if(e=await (0,tA.eq)(t,e),tv.validateItemData(t.type,e))return{itemData:e,itemDataVersion:"draft"};throw{itemData:e,itemDataVersion:"draft"}}catch(e){if((0,o.m5)(t.itemDetails))return{itemData:await tv.fetchPublishedItemData({type:t.type,itemId:t.itemDetails.id,authManager:t.authManager,portalHost:t.portalHost}),itemDataVersion:"published"};if(404===e.code){let e=t_(t.itemDetails.id),i=new tb.w(t.itemDetails.id,e&&e.data?e&&e.data:void 0);throw L.A.trackEvent(L.A.Category.Error,L.A.Action.Error_DraftDataMissing,t.trackRecoveryMode?L.A.Name.Draft_Recovery:void 0),i}throw e}}}setPendingChanges(t,e,i){this.pendingChanges.set(e,{type:t,status:i})}getPendingChangesFor(t){return this.pendingChanges.get(t)}hasPendingChanges(t){let e=Array.from(this.pendingChanges.values());t&&(e=e.filter(({type:e})=>t===e));let i=Array.from(e.values()).map(({status:t})=>t).includes(!0);return i||t||this.pendingChanges.clear(),i}constructor(t){super(t),this.itemDraftDataJSON="",this.isPublishWorkflowLocked=!1,this.itemResourcesEditInfo={},this.trackThirdPartyAppEditorApp=()=>{let t=(0,$.cW)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:S.MZ})[0];t&&L.A.trackEvent(L.A.Category.ThirdParty,this.type+L.A.Action.ThirdParty_Edited,t)},this.trackThirdPartyPubliserApp=()=>{let t=(0,$.cW)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:S.lt})[0];t&&L.A.trackEvent(L.A.Category.ThirdParty,this.type+L.A.Action.ThirdParty_Published,t)},this.isDataLossAllowed=!1,this.isDataRecoveryPendingReview=!1,this.pendingChanges=new Map,this.pendingChangesKey=Symbol(),this.isDraftDataFetchedFromPublishedData=!1,this.getItemPublishDate=()=>this.getItemPublishStatus()===B.hX.published&&super.getItemPublishDate(),this.setItemResourceIdsToKeep=t=>{this.itemResourceIdsToKeep=new Set(t)},this.upsertItemResource=t=>{let e=async()=>{try{return await _({...t,authManager:this.authManager,config:this.config,itemDetails:this.itemDetails,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo})}catch(t){if(t instanceof A){if(await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed)return e();return{success:!1}}throw await (0,X.Cp)(this.config,t),Error()}};return e()},this.confirmDataLossBeforeSave=async(t={})=>{try{await P({authManager:this.authManager,config:this.config,currentResourceProperties:t.currentResourceProperties,isDataLossAllowed:this.isDataLossAllowed,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,resourceName:t.resourceName})}catch(t){if(t instanceof A)await this.handleDataLossWarning(t.resourceProperties);else throw t}},this.addPendingItemRequest=t=>{let e=(0,m.YZ)(this.pendingItemRequests).then(t);return this.pendingItemRequests=e,e},this.shareStory=t=>{let e=async()=>{let e=this.isTemplate&&(0,M._E)(this.type)?U[this.type]:k[this.type];L.A.trackEvent(e,L.A.Action.Story_ShareStory,t?.access??this.itemSharingLevel.access);let i=await F({authManager:this.authManager,config:this.config,fallbackThumbnailUrl:`${location.origin}${(0,tm.b9)(this.config.BASE_URL)}`,isDataLossAllowed:this.isDataLossAllowed,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,sharingLevel:t??this.itemSharingLevel,type:this.type});return this.emit("share-end",i),i};return this.addPendingItemRequest(e)},this.saveDraft=()=>{let t=async()=>{if(!this.isDataRecoveryPendingReview)try{this.emit("story-save-start"),this.setPendingChanges("save",this.pendingChangesKey,!0),this.trackThirdPartyAppEditorApp(),await this.updateDataAndDetails(0);let{draftData:t,itemDetails:e,updateResources:i}=await (({itemDetails:t,...e})=>((0,M.$l)(t)===B.hX.published&&(t.typeKeywords=K(B.hX.unpublishedChanges,t.typeKeywords??[])),G({...e,itemDetails:t,mode:g.uB.DRAFT_SAVE})))({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,itemData:this.itemData,itemDetails:this.itemDetails,itemDraftData:this.itemDraftData,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo,itemResourceIdsToKeep:this.itemResourceIdsToKeep,storeBackup:this.storeBackup,type:this.type});this.setItemDetails(e),this.onSaveEnd(void 0,[t,e,i])}catch(t){t instanceof A&&(await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed&&this.saveDraft()),await (0,X.Cp)(this.config,t)}};return this.addPendingItemRequest(t)},this.setTopicTags=t=>{if(!t?.length)return void this.removeTopicTags();let e=(0,$.d6)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:S.hd,data:t});this.setItemDetails({...this.itemDetails,typeKeywords:e})},this.removeTopicTags=()=>{this.setItemDetails({...this.itemDetails,typeKeywords:(0,$.OM)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:S.hd})})},this.publishStory=()=>{let t=async()=>{if(this.onPublishMethodStart(1))try{let t=this.itemDetails.properties?.allowedTranslations;await this.emitBeforePublish(t=>this.emit("publishStatusUpdate",t)),this.emit("story-save-start"),this.setPendingChanges("publish",this.pendingChangesKey,!0);let e=this.getItemPublishStatus()===B.hX.draft;await this.updateDataAndDetails(1);let{draftData:i,itemDetails:a,updateResources:s,serverItemData:r,shareItem:o,itemDraftData:n}=await z({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,fallbackThumbnailUrl:`${location.origin}${(0,tm.b9)(this.config.BASE_URL)}`,itemDetails:this.itemDetails,itemDraftData:this.itemDraftData,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo,sharingLevel:this.itemSharingLevel,storeBackup:this.storeBackup,type:this.type,previousAllowedTranslations:t});this.trackThirdPartyPubliserApp(),this.setItemDetails(a),this.setItemData(n),this.onSaveEnd(void 0,[i,a,s]);let l=[[i,a,s],o,r],h=(await this.authManager?.getUser()).userLicenseTypeId;await tc({type:this.type,itemDetails:this.itemDetails,isTemplate:this.isTemplate,itemData:this.itemData,firstPublish:e,licenseType:h,authManager:this.authManager,config:this.config}),this.onPublishMethodEnd(1,[e,null,l])}catch(t){if(t instanceof A)await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed&&this.publishStory();else throw this.onPublishMethodEnd(1,[!1,t]),await (0,X.Cp)(this.config,t),Error(t)}};return this.addPendingItemRequest(t)},this.discardUnpublishedChanges=t=>{let e=async()=>{if(this.onPublishMethodStart(3))try{this.emit("story-save-start"),this.setPendingChanges("publish",this.pendingChangesKey,!0);let{draftData:e,itemDetails:i,updateResources:a}=await (({itemDetails:t,...e})=>(t.typeKeywords=K(B.hX.published,t.typeKeywords??[]),G({...e,itemDetails:t,itemDraftData:e.itemData,mode:g.uB.DISCARDING_UNPUBLISHED_CHANGES})))({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,itemData:this.itemData,itemDetails:this.itemDetails,isDataLossAllowed:this.isDataLossAllowed,isDuplicateCleanup:t,itemResourcesEditInfo:this.itemResourcesEditInfo,storeBackup:this.storeBackup,type:this.type});this.setItemDraftData(this.itemData),this.setItemDetails(i);let s=[e,i,a];this.onSaveEnd(void 0,[s]),t||L.A.trackEvent(k[this.type],L.A.Action.Story_DiscardUnpublishedChanges),this.onPublishMethodEnd(3,[s])}catch(t){if(t instanceof A)await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed&&await this.discardUnpublishedChanges();else throw this.onPublishMethodEnd(3,[null,t]),await (0,X.Cp)(this.config,t),Error(t)}};return this.addPendingItemRequest(e)},this.unpublishStory=t=>{let e=async()=>{if(this.onPublishMethodStart(2))try{this.emit("story-save-start"),this.setPendingChanges("publish",this.pendingChangesKey,!0),await this.updateDataAndDetails(2,t);let{draftData:e,itemDetails:i,updateResources:a,shareItem:s,itemData:r}=await W({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,fallbackThumbnailUrl:`${location.origin}${(0,tm.b9)(this.config.BASE_URL)}`,itemDetails:this.itemDetails,itemDraftData:this.itemDraftData,isDataLossAllowed:this.isDataLossAllowed,isDuplicateCleanup:t,itemResourcesEditInfo:this.itemResourcesEditInfo,storeBackup:this.storeBackup,type:this.type,sharingLevel:te.s});this.setItemData(r),this.setItemDetails(i),this.itemSharingLevel=te.s,this.onSaveEnd(void 0,[e,i,a]);let o=[[e,i,a],s];t||L.A.trackEvent(this.isTemplate&&(0,M._E)(this.type)?U[this.type]:k[this.type],this.isTemplate?L.A.Action.Builder_Template:tw[this.type]),this.onPublishMethodEnd(2,[o])}catch(t){if(t instanceof A)await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed&&this.unpublishStory();else throw this.onPublishMethodEnd(2,[null,t]),await (0,X.Cp)(this.config,t),Error(t)}};return this.addPendingItemRequest(e)},this.hasUnsavedChanges=async()=>this.itemDraftDataJSON!==JSON.stringify((await this.getStoryData(0)).itemData),this.setGetStoryDataMethod=t=>{this.getStoryData=t},this.setGenerateStoryItemUrlMethod=t=>{this.generateStoryItemUrl=t},this.setEmitBeforePublish=t=>{this.emitBeforePublish=t},this.setConfirmDataLossMethod=t=>{this.confirmDataLoss=t},this.setConfirmAdminAction=t=>{this.confirmAdminAction=t},this.fetchStoryBuilderData=async()=>{try{let t={itemId:this.itemId,authManager:this.authManager,portalHost:this.config.PORTAL_HOST},e={...t,type:this.type},i=await tv.fetchItemDetails(t);if("update"!==i.itemControl&&"admin"!==i.itemControl&&!i.origin)throw new ta.D({type:"story-privileges-edit",itemType:this.type});if(this.setItemDetails(i),i.origin)throw new ta.D({type:"distributed-collab-no-draft"});let a=(0,ts.k8)(this.config.ITEM_SHARING_OPTIONS,this.itemDetails.typeKeywords),s=await (0,o.L)({itemDetails:this.itemDetails,authManager:this.authManager,excludeFavoritesGroup:!0});this.itemSharingLevel={access:this.itemDetails.access,groups:s,isUnlisted:a};try{let{itemData:t,itemDataVersion:e}=await tv.fetchItemDraftData({itemDetails:this.itemDetails,type:this.type,authManager:this.authManager,portalHost:this.config.PORTAL_HOST,trackRecoveryMode:!0});this.setItemDraftData(t),"published"===e&&(this.isDraftDataFetchedFromPublishedData=!0,this.setItemData(t))}catch(t){if((0,tb.p)(t))this.isDataRecoveryPendingReview=!0,this.setItemDraftData(t.recoveryDraftData);else throw await (0,X.Cp)(this.config,t),t}if(await w({authManager:this.authManager,config:this.config,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,resourceName:"draft.json"}),this.getItemPublishStatus()!==B.hX.draft){let t=await tv.fetchPublishedItemData(e);this.setItemData(t)}}catch(t){if(t instanceof a.Lf&&t.code===O.ZJ.READ_ONLY_MODE)throw new ta.D({type:"read-only-mode"})}},this.isStoryOwner=async()=>{let t=await this.authManager?.getUser();return t?.username===this.itemOwner},this.duplicateStory=async(t="draft")=>{let e=`${(0,u.mZ)(this.config.PORTAL_HOST,this.authManager)}/content/users/${this.itemOwner}/items/${this.itemId}/copy`,i=t instanceof Set?t:new Set([t]),s=i.has("draft"),r=i.has("published"),o=[{mode:"draft",tag:tp.lI.DRAFT},{mode:"published",tag:tp.lI.PUBLISHED},{mode:"from-template",tag:tp.lI.FROM_TEMPLATE},{mode:"to-template",tag:tp.lI.TO_TEMPLATE}].filter(({mode:t})=>i.has(t)).map(({tag:t})=>t),n=(0,y.c)(this.itemDetails),l=await (0,a.Em)(e,{authentication:this.authManager,params:{includeResources:!0,copyPrivateResources:s,tags:o.join(","),...n?{updateItemType:!0}:{},f:"json"}});L.A.trackEvent(this.isTemplate&&(0,M._E)(this.type)?U[this.type]:k[this.type],this.isTemplate?L.A.Action.Builder_Template:tP[this.type],r?L.A.Name.ItemStatistics_DuplicatePublishedItem:L.A.Name.Builder_Common_Duplicate);let d={itemId:l.itemId,authManager:this.authManager,portalHost:this.config.PORTAL_HOST},c={delay:5e3};if(r)try{if(this.itemDetails&&this.itemDetails.typeKeywords&&this.getItemPublishDate()<new Date(16384032e5))throw Error("Check item data for published data immediately");await (0,m.O$)(tD.$.fetchPublishedItemData,{promiseArguments:[{...d,type:this.type,onlyReturnPublishedDataJsonResource:!0}],...c,maxRetries:12})}catch{await (0,m.O$)(tD.$.fetchPublishedItemData,{promiseArguments:[{...d,type:this.type}],...c,maxRetries:3})}else{let t=await tv.fetchItemDetails(d);await (0,m.O$)(h.hB,{promiseArguments:[{itemDetails:t,portalHost:this.config.PORTAL_HOST,authManager:this.authManager}],...c,maxRetries:60})}return l},this.duplicateStoryCleanup=async t=>{let{titlePrefix:e,untitledItemString:i}=t,a=(0,tA.BT)(this.itemDetails,this.isDraftDataFetchedFromPublishedData),s=a.has("from-template"),r=a.has("to-template");a.has("published")&&await this.discardUnpublishedChanges(!0);let o=s?"":`${e} `;if(this.type===p.z.Theme){let t=await function(t,e){let i=(0,tr.pZ)({stringModifier:e.titlePrefix,originalString:t.title??e.untitledItemString,maxLength:O.s1});return{...t,title:i}}(this.itemDraftData,{untitledItemString:i,titlePrefix:o});this.setItemDraftData(t)}else{let t=await this.authManager?.getUser(),e=function(t){let{itemData:e,coverOptions:i,duplicateMode:a}=t,s=a.has("published");return e.nodes=Object.keys(e.nodes).reduce((t,a)=>{let r=e.nodes[a];if(ty(r)){let e=r;if(s&&(e=function(t){if(!ty)return t;let e=t.config;if(!e?.analytics)return t;let i=structuredClone(e);return delete i.analytics,{...t,config:i}}(e)),"story"===r.type&&(r.config?.allowedTranslations||r.config?.shouldUnlink)){let t=r.config;delete t.allowedTranslations,delete t.shouldUnlink,e={...e,config:t}}return e=function(t,e){if(!ty)return t;let i=t.data;if(!i.metaSettings||"string"!=typeof i.metaSettings.title)return t;let a=structuredClone(i.metaSettings);return a.title=(0,tr.pZ)({stringModifier:e,originalString:i.metaSettings.title,maxLength:Q.r4}),{...t,data:{...i,metaSettings:a}}}(e,i.titlePrefix),{...t,[a]:e}}return tf(r)?{...t,[a]:function(t,e){if(!["storycover","collection-cover"].includes(t.type))return t;let i=t.data,a=i.title,s=(0,tm.Zt)(a)?e.untitledItemString:a,r=(0,tr.pZ)({stringModifier:e.titlePrefix,originalString:s,maxLength:Q.r4}),o=(0,tm.cT)(e.user.firstName,e.user.lastName);return{...t,data:{...i,title:r,byline:o}}}(r,i)}:{...t,[a]:r}},{}),e}({itemData:this.itemDraftData,coverOptions:{untitledItemString:i,titlePrefix:o,user:t},duplicateMode:a});this.setItemDraftData(e)}let n=function(t,e){if("title"in t)return t.title??e;if("nodes"in t)for(let i in t.nodes){let a=t.nodes[i];if(tf(a))return a.data.title??e}return e}(this.itemDraftData,i),l=(t=>{let{itemDetails:e,title:i,isRegularItemDuplicatedFromTemplate:a,isTemplateDuplicatedFromRegularItem:s}=t,r=(0,q.T)(e);if(r?.metaProperties?.title){let t=structuredClone(r);t.metaProperties?.title&&(t.metaProperties.title=i,r=(0,q.c)(t,e))}return e.properties?.allowedTranslations&&delete e.properties.allowedTranslations,{...e,...e.classification?{classification:""}:{},title:i,properties:r,tags:e.tags?.filter(t=>t!==tp.lI.DRAFT&&t!==tp.lI.PUBLISHED&&t!==tp.lI.TO_TEMPLATE&&t!==tp.lI.FROM_TEMPLATE),typeKeywords:a?e.typeKeywords?.filter(t=>t!==S.Jv):s?[...e.typeKeywords??[],S.Jv]:e.typeKeywords?.filter(t=>!t.includes(S.Z$))}})({itemDetails:this.itemDetails,title:n,isRegularItemDuplicatedFromTemplate:s,isTemplateDuplicatedFromRegularItem:r});return this.setItemDetails(l),await this.unpublishStory(!0),a},this.fetchItemResource=async({skipEditInfoTracking:t,...e})=>{let i=await super.fetchItemResource(e);return t||await w({authManager:this.authManager,config:this.config,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,resourceName:e.resourceName}),i},this.getItemFirstPublishDate=()=>this.getItemPublishStatus()===B.hX.published&&super.getItemFirstPublishDate(),this.autosaveStory=(0,m.GR)(this.saveDraft,{debounceTime:1e3,throttleTime:1e4,confirmBeforeUnload:!0,setFnStatusBeforeUnload:()=>this.setPendingChanges,onImmediateCallback:t=>{this.removePristineTypeKeyword(),this.isPublishWorkflowLocked?t("Cancel: pending publish"):this.cancelPendingAutosave=t}}),this.onSaveEnd=(t,e,i)=>{window.removeEventListener("beforeunload",this.defaultWindowUnloadEvent),this.emit("story-save-end",t,e,i),this.setPendingChanges("save",this.pendingChangesKey,!1)},this.getPublishEventName=t=>{switch(t){case 1:return"story-publish";case 3:return"discard-unpublished-changes";default:return"story-unpublish"}},this.onPublishMethodStart=t=>!this.isPublishWorkflowLocked&&!this.isDataRecoveryPendingReview&&(this.cancelPendingAutosave?.("Cancel: Publish method started"),this.isPublishWorkflowLocked=!0,this.emit(`${this.getPublishEventName(t)}-start`),window.addEventListener("beforeunload",this.defaultWindowUnloadEvent),!0),this.onPublishMethodEnd=(t,e)=>{this.isPublishWorkflowLocked=!1,this.emit(`${this.getPublishEventName(t)}-end`,...e),this.emit("publish-method-end"),window.removeEventListener("beforeunload",this.defaultWindowUnloadEvent)},this.onDataOverwriteRejected=()=>{window.removeEventListener("beforeunload",this.defaultWindowUnloadEvent),this.emit("DATA_OVERWRITE_REJECTED")},this.getStoryData=async t=>({itemDetails:{},itemData:{root:"",nodes:{},resources:{}}}),this.generateStoryItemUrl=()=>{throw Error("Generate-url function not provided")},this.emitBeforePublish=t=>Promise.resolve(),this.updateDataAndDetails=async(t,e)=>{let i=e?{itemData:this.itemDraftData,itemDetails:this.itemDetails}:await this.getStoryData(t);if(void 0!==i){if((1===t||0===t)&&this.setItemDraftData(i.itemData),1===t||2===t||this.getItemPublishStatus()===B.hX.draft){let e={...this.itemDetails,...i.itemDetails};e.title||(e.title=(0,tA.x2)({type:this.type,dateStamp:e.created})),this.getItemPublishStatus()===B.hX.draft&&1!==t&&2!==t&&delete i.properties?.allowedTranslations,this.type!==p.z.Theme&&(1===t?e.url=this.generateStoryItemUrl((0,tt.WU)({route:"viewer",itemId:this.itemId,itemType:this.type,isTemplate:this.isTemplate})):2===t&&(e.url=""));let a=void 0===i.shouldPushMetaToAGOItemDetails?Z.s:i.shouldPushMetaToAGOItemDetails;if(await tS({type:this.type,itemDetails:e,itemProperties:i.properties,thumbnail:i.thumbnail,baseUrl:this.config.BASE_URL,authManager:this.authManager,portalHost:this.config.PORTAL_HOST,shouldPushMetaToAGOItemDetails:a,shouldForceUpdateThumbnail:i.hasShouldPushMetaToAGOItemDetailsChanged&&a}),a){let t=i.properties?.metaProperties;t?.title&&(e.title=t.title),t?.description&&(e.snippet=t.description),delete i.properties?.metaProperties,delete e.properties?.metaProperties}else delete e.title,delete e.snippet,delete e.description;i.properties&&(e.properties=(0,q.c)(i.properties,e)),e.clearEmptyFields=!0,this.setItemDetails(e)}}else throw Error("Story data not getting updated.")},this.defaultWindowUnloadEvent=t=>{t.preventDefault(),t.returnValue=""},this.downloadDraftRecoveryFileFromConsole=()=>{((t,e)=>{try{{let e=tI(t),i=t_(t);if(i&&1)return(0,l.mS)(i.data,`StoryMap_Draft_Recovery_${t}`),window.localStorage.setItem(e,JSON.stringify({...i,downloaded:!0})),!0}}catch{}return!1})(this.itemId)||console.error("No draft recovery file available for download.")},this.storeBackup=()=>{try{let t={timestamp:Date.now(),downloaded:!1,data:this.itemDraftData};window.localStorage.setItem(tI(this.itemId),JSON.stringify(t))}catch{}},this.handleDataLossWarning=async t=>{if(t?.editInfo&&"function"==typeof this.confirmDataLoss){if(!await this.confirmDataLoss(t.editInfo))throw this.onDataOverwriteRejected(),Error(Q.mu);this.isDataLossAllowed=!0,setTimeout(()=>{this.isDataLossAllowed=!1},5e3)}},this.removePristineTypeKeyword=()=>{this.itemDetails.typeKeywords?.includes(S.DD)&&this.setItemDetails({...this.itemDetails,typeKeywords:this.itemDetails.typeKeywords.filter(t=>t!==S.DD)})},window.downloadDraftRecoveryFile=this.downloadDraftRecoveryFileFromConsole}get itemDraftData(){return this._itemDraftData}set itemDraftData(t){if(this._itemDraftData)throw Error("Item draft data have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemDraftData(t)}get itemLastSavedTimestamp(){return this.itemResourcesEditInfo.DRAFT_DATA_RESOURCE?.modified??this.itemDetails.modified}updateAppVersion(t=0){let e=1===t||2===t?ti.by.published:ti.by.draft,i=(this.itemDetails.typeKeywords??[]).filter(t=>0!==t.search(e));2===t?this.setItemDetails({...this.itemDetails,typeKeywords:i}):this.setItemDetails({...this.itemDetails,typeKeywords:[...i,`${e}:${this.config.APP_VERSION}`]})}setItemPublishStatus(t){let e=K(t,this.itemDetails.typeKeywords??[]);this.setItemDetails({...this.itemDetails,typeKeywords:[...e]})}setItemFirstPublishDate(t){let e=(this.itemDetails.typeKeywords??[]).filter(t=>!t.match(ti.cC.firstPublishedDate));"remove"===t?this.setItemDetails({...this.itemDetails,typeKeywords:[...e]}):this.setItemDetails({...this.itemDetails,typeKeywords:[...this.itemDetails.typeKeywords??[],`${ti.cC.firstPublishedDate}:${new Date(t).getTime()}`]})}setItemDraftData(t){let e=J.CY.sanitize(t,{allowUndefined:!0});this._itemDraftData=e,this.itemDraftDataJSON=JSON.stringify(e)}}let tT=tv},345081:(t,e,i)=>{i.d(e,{$:()=>I,A:()=>_});var a=i(535978),s=i(647682),r=i(777011),o=i(724875),n=i(443331),l=i(20771),h=i(52457),d=i(671012),u=i(996622),c=i(111970),m=i(362420),p=i(301972),y=i(501411),f=i(718230),g=i(338959),S=i(307557),b=i(986132),A=i(771543),D=i(811579);class I extends a.EventEmitter{static{this.validateItemData=(t,e)=>{switch(t){case o.z.Briefing:case o.z.Collection:case o.z.Frame:case o.z.Story:return e&&"string"==typeof e.root;case o.z.Theme:return e&&"object"==typeof e;default:return!1}}}static{this.fetchItemDetails=async t=>{let e=t.authManager?t.authManager:void 0;return await (0,s.Gq)(t.itemId,{authentication:e,portal:e?void 0:(0,n.mZ)(t.portalHost),signal:t.signal})}}static{this.fetchPublishedItemData=async t=>{let e=await (0,l.e)({itemId:t.itemId,authManager:t.authManager,portalHost:t.portalHost,language:t.language,onlyReturnPublishedDataJsonResource:t.onlyReturnPublishedDataJsonResource,signal:t.signal,timeStamp:t.timeStamp});if(e=await (0,D.eq)(t,e),I.validateItemData(t.type,e))return e;let i=Error(`invalid json response body at ${(0,n.mZ)(t.portalHost,t.authManager)}/content/items/${t.itemId}/data. reason: Unexpected end of JSON input`);throw i.name="FetchError",i.type="invalid-json",i}}constructor(t){super(),this._isOrgItem=!1,this._viewerMode="view",this.preloadedItemResourceImages={},this._isTemplate=!1,this.getItemResourceUrl=(t,e)=>{let i=t.authManager||this.authManager,a=this.shouldItemResourceUseCDN(),s=t.queryParameters?Object.assign({},t.queryParameters):{};!t.skipToken&&!a&&i&&i.token&&(s.token=i.token);let r=`${t.sharingUrl??(0,n.mZ)(this.config.PORTAL_HOST)}/content/items/${e??this.itemId}/resources/${t.resourceName}${Object.keys(s).length?"?"+(0,h.lK)(s):""}`;return a&&(r=r.replace(/^https:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com")),r},this.preloadItemResourceImage=(t,e)=>{let i=this.getKeyForPreloadedItemResourceImage(t,e);return new Promise(a=>{if(void 0!==this.preloadedItemResourceImages[i])a({image:this.preloadedItemResourceImages[i],key:i,fileName:t,width:e});else{let s=new Image;s.src=this.getItemResourceImageFullUrl({imageFileName:t,width:e}),s.onload=()=>{this.preloadedItemResourceImages[i]=s,a({image:s,key:i,fileName:t,width:e})},s.onerror=i=>{a({error:i.error,fileName:t,width:e})}}})},this.getSupportedTranslationLocales=()=>Object.keys((0,d.T)(this.itemDetails)?.translations??{}),this.getOriginalStoryLocale=(t="en-us")=>this.itemDetails.culture??t,this.getKeyForPreloadedItemResourceImage=(t,e)=>`${t}_w${e}`,this._fetchItemResource=async t=>{let e=this.getItemResourceUrl({...t,skipToken:!0}),i=await (0,r.Em)(e,{authentication:this.authManager,httpMethod:"GET"});return/\.json$/.test(t.resourceName)?u.CY.sanitize(i,{allowUndefined:!0}):i},this._type=t.type,this.config=t.config,this.version=t.version,t.authManager&&(this.authManager=t.authManager),this._getStoryMapUserPrivileges=t.getStoryMapUserPrivileges,t.viewerMode&&(this.viewerMode=t.viewerMode)}get isTemplate(){return this._isTemplate}get itemId(){return this._itemId}set itemId(t){this._itemId||(this._itemId=t)}get type(){return this._type}get itemOwner(){return this._itemOwner}get itemDetails(){return this._itemDetails}set itemDetails(t){if(this._itemDetails)throw Error("Item details have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemDetails((0,c.if)(t)?(0,c.Nr)(t):t)}get itemData(){return this._itemData}set itemData(t){if(this._itemData)throw Error("Item data have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemData(t)}get itemSharingLevel(){return this._itemSharingLevel?this._itemSharingLevel.access===m.uQ.PRIVATE&&this._itemSharingLevel.groups?.length&&this._itemSharingLevel.groups?.length>0?{access:m.uQ.SHARED,groups:this._itemSharingLevel.groups,isUnlisted:!1}:this._itemSharingLevel:this.itemDetails&&this.itemDetails.access?{access:this.itemDetails.access,groups:[],isUnlisted:this.itemDetails.typeKeywords?.includes(p.aE)??!1}:b.s}set itemSharingLevel(t){this._itemSharingLevel=t}get selectedTopicTagIds(){let t=(0,c.Ad)(this.itemDetails);return JSON.stringify(t)!==JSON.stringify(this._selectedTopicTagIds)&&(this._selectedTopicTagIds=t),this._selectedTopicTagIds}set version(t){this._itemVersion=t}get version(){return this._itemVersion}get isOrgItem(){return this._isOrgItem}set viewerMode(t){this._viewerMode=t}get viewerMode(){return this._viewerMode}get authManager(){return this._authManager}set authManager(t){!this.itemOwner&&t&&t.username&&(this._itemOwner=t.username),this._authManager=t}get storyMapUserPrivileges(){return this._getStoryMapUserPrivileges()}getItemPublishDate(){try{let t=(0,y.cW)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:A.cC.publishedDate})[0]||(0,y.cW)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:"publish-date"})[0];if(t)return new Date(parseInt(t,10));throw Error("No published date")}catch{if("builder"===this.viewerMode)return!1;return new Date(this.itemDetails?this.itemDetails.created:Date.now())}}getItemFirstPublishDate(){try{let t=(0,y.cW)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:A.cC.firstPublishedDate})[0];if(t)return new Date(parseInt(t,10));throw Error("No first published date")}catch{if("builder"===this.viewerMode)return!1;return new Date(this.itemDetails?this.itemDetails.created:Date.now())}}getItemPublishStatus(){return void 0===this.itemDetails?f.hX.draft:(0,c.$l)(this.itemDetails)||f.hX.draft}getItemResourceImageFullUrl({imageFileName:t,width:e,itemId:i,shouldIgnoreDPR:a,sharingUrl:s}){if(!t)return"";if(t.startsWith("https://"))return t;let r=e&&(0,g.C)({width:e,fileName:t,shouldIgnoreDPR:a});return this.getItemResourceUrl({resourceName:t,authManager:void 0,sharingUrl:s,queryParameters:r?{w:r}:void 0},i)}unloadPreloadedItemResourceImage(t,e){delete this.preloadedItemResourceImages[this.getKeyForPreloadedItemResourceImage(t,e)]}shouldItemResourceUseCDN(){return"view"===this.viewerMode&&"www.arcgis.com"===this.config.PORTAL_HOST&&this.itemSharingLevel.access===m.uQ.PUBLIC}fetchItemResource(t){return this._fetchItemResource(t)}setItemDetails(t){this._itemId=t.id,this._itemOwner=t.owner,this._isTemplate=(0,c.WE)(t),this._itemDetails=t,(0,S.Eu)(this._itemDetails)&&(this._isOrgItem=!0)}setItemData(t){let e=u.CY.sanitize(t,{allowUndefined:!0});this._itemData=e}}let _=I},377888:(t,e,i)=>{i.d(e,{p:()=>s,w:()=>a});class a extends Error{constructor(t,e){super("Draft data is missing"),this.itemId=t,e&&(this.recoveryDraftData=e)}getRecoveryDataForDownload(){if(this.recoveryDraftData)return`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(this.recoveryDraftData))}`}}let s=t=>t instanceof a&&!!t.recoveryDraftData},438304:(t,e,i)=>{i.d(e,{$v:()=>S,EA:()=>g,O1:()=>D,QM:()=>f,R4:()=>c,bj:()=>I,fd:()=>u,hm:()=>d,td:()=>_,vH:()=>p});var a=i(805341),s=i(9736),r=i(922658),o=i(718230),n=i(124490),l=i(850415),h=i(771543);let d=async({blob:t,fileType:e,config:i,disallowedMimeTypes:a})=>{let r;if(e===h.O2.Audio||e===h.O2.Video||e===h.O2.ImageOrVideo||e===h.O2.Image360||e===h.O2.Image)if(i)r=await p({blob:t,fileType:e,config:i,disallowedMimeTypes:a});else throw Error("Config cannot be undefined");else r=await p({blob:t,fileType:e});if(!r.isValid)throw r.details;return e===h.O2.GeoData?await y(t):await (0,s.aO)(t)},u=async(t,e)=>{let i=e?await (0,s.ti)(e):void 0,a=i?.ext,o=["heic","heif","webp","tiff","tif"].includes(a??""),n=e&&a?.match(/(jpg|jpeg|heic|heif|webp|tiff|tif)$/i)?await b(e):void 0;if(o)return{src:t,width:0,height:0,provider:"uri",location:n};try{let{width:e,height:i}=await (0,r.vX)(t);return{src:t,width:e,height:i,provider:"uri",location:n}}catch(t){throw Error(t)}},c=t=>{let{config:e,imageWidth:i,imageHeight:a,fileType:s}=t;if(s?.mime&&e?.SUPPORTED_COMPRESSIBLE_IMAGE_MIME_TYPES.includes(s.mime)){if(i>l.YM||a>l.YM)throw o.CF.INVALID_IMAGE_COMPRESSIBLE}else if(i>l.r1||a>l.r1)throw o.CF.MAX_FILE_SIZE_EXCEEDED},m=async t=>{let{blob:e,validMimeTypes:i,checkFileExtensionOnly:a}=t;if(a)return D(e.name,i).length>0;let r=await (0,s.ti)(e);if(!r)return!1;let{mime:o}=r;return!!i.find(t=>o===t)},p=async({blob:t,fileType:e,config:i,disallowedMimeTypes:a})=>{let s,r=[],d=[],u=[],c=[];switch((e===h.O2.Video||e===h.O2.Audio||e===h.O2.ImageOrVideo||e===h.O2.Image360||e===h.O2.Image)&&void 0!==i&&(r=(0,n.Yn)(h.O2.Video,i,a),d=(0,n.Yn)(h.O2.Audio,i,a),u=(0,n.Yn)(h.O2.Image,i,a),c=(0,n.Yn)(h.O2.Image360,i,a)),e){case h.O2.Image:s=u;break;case h.O2.Image360:s=c;break;case h.O2.Video:s=r;break;case h.O2.Audio:s=d;break;case h.O2.ImageOrVideo:s=[...u,...r];break;case h.O2.File:s=l.pp;break;case h.O2.GeoData:s=l.X0;break;default:return{isValid:!1,details:o.CF.INVALID_FILE_TYPE}}let p=await m({blob:t,validMimeTypes:s,checkFileExtensionOnly:e===h.O2.GeoData}),y=e;p&&e===h.O2.ImageOrVideo&&(y=-1!==r.findIndex(e=>e===t.type)?h.O2.Video:h.O2.Image);let f="image/gif"===t.type||"application/pdf"===t.type||"text/vtt"===t.type||y===h.O2.Video||y===h.O2.Audio?t.size>l.w3:y===h.O2.GeoData?t.size>l.B0:y===h.O2.Image360?t.size>l.iN:t.size>l.WP,g=!1,S=!1;y===h.O2.Image&&i?.SUPPORTED_COMPRESSIBLE_IMAGE_MIME_TYPES&&(S=await m({blob:t,validMimeTypes:i.SUPPORTED_COMPRESSIBLE_IMAGE_MIME_TYPES,checkFileExtensionOnly:!1}),g=t.size<l.w3&&S);let b=p&&(!f||g),A="";return p?f&&!S?A=o.CF.MAX_FILE_SIZE_EXCEEDED:S&&(A=o.CF.INVALID_IMAGE_COMPRESSIBLE):A=o.CF.INVALID_FILE_TYPE,{isValid:b,details:A}},y=async t=>{let e;try{e=await t.text()}catch{throw o.CF.FILE_READ_ERROR}if(e?.length)return e;throw o.CF.FILE_READ_ERROR},f=t=>new Promise((e,i)=>{let a=t.blob||(0,s.zM)(t.data.src),r=g(a.type);t.storyBuilder.upsertItemResource({resourceName:r,resource:a,isAdd:!0}).then(()=>{let i={provider:"item-resource",resourceId:r};t.data.width&&(i.width=t.data.width),t.data.height&&(i.height=t.data.height),t.data.name&&(i.name=t.data.name),e(i)}).catch(()=>{i()})}),g=t=>{let e=t.slice(t.indexOf("/")+1);return"svg+xml"===e&&(e="svg"),S(e)},S=t=>`${(0,a.Ak)()}.${t}`,b=async t=>{try{await Promise.all([i.e(51642),i.e(33506)]).then(i.bind(i,733506));let e=await Promise.all([i.e(51642),i.e(20915)]).then(i.t.bind(i,120915,23)),a=await e.gps(t);if(a?.latitude&&a?.longitude)return{latitude:a.latitude,longitude:a.longitude};return}catch(t){return}},A=t=>RegExp(`\\.${t}$`,"i"),D=(t,e)=>{for(let i of e){let e=A(i);if(t.match(e))return i}return""},I=async t=>{let e=await (0,s.ti)(t),a=-1!==l.Wr.findIndex(t=>t===e?.mime),r=t.size>l.iN;if(!a||r)throw o.CF.INVALID_360_IMAGE;await Promise.all([i.e(51642),i.e(33506)]).then(i.bind(i,733506));let n=await Promise.all([i.e(51642),i.e(17203),i.e(4828)]).then(i.bind(i,217203)),h=await n.parse(t,{xmp:!0}),d=await (0,s.aO)(t),c=await u(d,t);if(h?.ProjectionType!=="equirectangular"){let t=c.width/c.height;if(t>=1.5&&t<=3)return c;throw o.CF.INVALID_360_IMAGE}return{...c,projectionType:"equirectangular"}},_=async(t,e,i,a)=>{if(t===h.O2.Image){let t=!0;if(l.gC.includes(e))try{let e=await d({blob:a,fileType:h.O2.Image,config:i}),{width:s,height:o}=await (0,r.vX)(e);t=(s>l.r1||o>l.r1)&&s<l.YM&&o<l.YM}catch(e){t=!1}let s=a.size>l.WP&&a.size<l.w3;return(t||s)&&(i.SUPPORTED_COMPRESSIBLE_IMAGE_MIME_TYPES.includes(e)||i.SUPPORTED_CONVERTIBLE_IMAGE_MIME_TYPES.includes(e))}return t===h.O2.GeoData||(t===h.O2.Audio?i.SUPPORTED_CONVERTIBLE_AUDIO_MIME_TYPES.includes(e):i.SUPPORTED_CONVERTIBLE_VIDEO_MIME_TYPES.includes(e))}},550762:(t,e,i)=>{i.d(e,{F4:()=>d,VG:()=>h,hB:()=>u});var a=i(647682),s=i(307557),r=i(443331),o=i(301972),n=i(111970),l=i(501411);let h=t=>/^draft(?:_\d+)?.json$/.test(t),d=t=>t.filter(t=>h(t.resource)).sort((t,e)=>{let i=RegExp(`${o.xq}(?<timestamp>[0-9]+).json`,"g"),a=RegExp(`${o.xq}(?<timestamp>[0-9]+).json`,"g"),s=i.exec(t.resource)?.groups?.timestamp,r=a.exec(e.resource)?.groups?.timestamp;return void 0===s?1:void 0===r?-1:Number(r)-Number(s)}),u=async t=>{let{itemDetails:e,...i}=t;try{let a=(0,l.cW)({typeKeywords:e.typeKeywords,typeKeywordId:o.Fc})[0]||"draft.json";return await (0,s.aK)({...i,itemId:t.itemDetails.id,resourceId:a,httpMethod:"POST"})}catch(o){if((0,n.NJ)(e))return{...await (0,a.MB)(t.itemDetails.id,{authentication:t.authManager}),title:e.title,snippet:e.snippet};for(let e of d(await (0,s.EY)({authManager:t.authManager,username:t.itemDetails.owner,itemId:t.itemDetails.id,portal:(0,r.mZ)(t.portalHost,t.authManager)})))try{return await (0,s.aK)({...i,itemId:t.itemDetails.id,resourceId:e.resource,httpMethod:"POST"})}catch{}throw o}}},592391:(t,e,i)=>{i.d(e,{H:()=>r,c:()=>s});var a=i(301972);let s=t=>t.type!==a.tm&&t.type!==a.Jk&&[...a.tQ,...a.vw].includes(t.type),r=t=>t.type===a.tm&&"SMX Item"!==t.type&&!!t?.typeKeywords?.includes("SMX Item")},658600:(t,e,i)=>{i.d(e,{CN:()=>o,by:()=>r,cC:()=>s,uB:()=>a});var a=function(t){return t[t.DRAFT_SAVE=0]="DRAFT_SAVE",t[t.PUBLISHING=1]="PUBLISHING",t[t.UNPUBLISHING=2]="UNPUBLISHING",t[t.DISCARDING_UNPUBLISHED_CHANGES=3]="DISCARDING_UNPUBLISHED_CHANGES",t}({}),s=function(t){return t.publishedDate="smpublisheddate",t.firstPublishedDate="smfirstpublisheddate",t.hasTranslation="smtranslated",t}({}),r=function(t){return t.published="smversionpublished",t.draft="smversiondraft",t}({}),o=function(t){return t.DRAFT="draft",t.PUBLISHED="published",t}({})},725881:(t,e,i)=>{i.d(e,{Lc:()=>u,Rs:()=>h,XH:()=>l});var a=i(647682),s=i(777011),r=i(301972),o=i(343942),n=i(810255);let l=async t=>{let e,{customSearchOptions:i,searchParams:s,...r}=t;if(s&&(r.params=s),i&&"groups"===i.searchType){let t=(await (0,a.N_)({...r,q:i.groupQuery})).results[0]?.id;e=await d(t,r)}else e=i&&"groupItems"===i.searchType?await d(i.groupId,r):await (0,a.Ds)(r);let o=e.results;if(t.authentication&&o.length>0){let i=(await t.authentication.getUser()).favGroupId,s=o.reduce((t,e,i)=>`${t} ${0===i?`AND id:("${e.id}"`:`OR "${e.id}"`}${i===o.length-1?"))":""}`,`(group:"${i}"`),r=await (0,a.Ds)({authentication:t.authentication,q:s,params:{num:o.length}}),n=o.map(t=>({...t,isFavorite:r.results.findIndex(e=>e.id===t.id)>=0}));return{...e,results:n}}return e},h=async(t,e,i)=>{if(i)return;let a=await (0,o.Tb)(t,e);return a&&"WO"!==a?`/Region/WO,/Region/${a}`:"/Region/WO"},d=(t,e)=>{let i=Object.keys(e).filter(t=>"authentication"!==t&&"params"!==t),r=(0,s.Oq)(e,i,{httpMethod:"GET"}),o=`${(0,a.e1)(r)}/content/groups/${t}/search`;if(r?.params?.paramStrArr){let t=Object.keys(r.params).reduce((t,e)=>{if(r.params[e]||"boolean"==typeof r.params[e]){let i="paramStrArr"===e?r.params[e].join("&"):`${e}=${r.params[e]}`;return t?`${t}&${i}`:`${i}`}return t},""),e={authentication:r.authentication};return(0,s.Em)(`${o}?${t}`,{...e}).then(t=>t)}return(0,s.Em)(o,r).then(i=>(i.nextStart&&-1!==i.nextStart&&(i.nextPage=()=>d(t,Object.assign({},e,{start:i.nextStart}))),i))},u=t=>{let e="string"==typeof t.filter?new n.q(t.filter):t.filter;return t.showUnlisted||e.and().startGroup().not().matchTypeKeywords(r.aE).endGroup(),(0,a.Ds)({...t,q:t.query??"",filter:e.toParam()})}},831393:(t,e,i)=>{i.d(e,{I:()=>s,R:()=>r});var a=i(647682);let s=({group:t,hasItemOwnerPermission:e,allowSharingToUpdateGroups:i})=>!!((t.userMembership?.memberType==="admin"||t.userMembership?.memberType==="owner"||!t.isViewOnly&&t.userMembership?.memberType==="member"&&e)&&(!i&&(!t.capabilities||!t.capabilities.includes("updateitemcontrol"))||i)),r=async(t,e)=>(await (0,a.tp)(t,{authentication:e,paging:{num:100,start:0},httpMethod:"GET"})).items.reduce((t,e)=>(t.push(e.id),t),[])},986132:(t,e,i)=>{i.d(e,{i:()=>s,s:()=>a});let a={access:i(362420).uQ.PRIVATE,groups:[],isUnlisted:!1},s={title:"common.arcgis.visibility.selector.accessLevel.heading",description:"common.arcgis.sharing.selector.accessLevel.description"}}}]);