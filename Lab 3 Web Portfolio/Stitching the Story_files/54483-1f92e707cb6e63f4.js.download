"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[54483],{9736:(e,t,r)=>{r.d(t,{QC:()=>m,YX:()=>l,aO:()=>o,mS:()=>d,sL:()=>s,ti:()=>p,zM:()=>n});var i=r(658456),a=r(718230);let o=e=>new Promise((t,r)=>{let i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=()=>{r(a.CF.FILE_READ_ERROR)},i.readAsDataURL(e)}),n=(e,t=512)=>{let r=e.split(",")[0].split(":")[1].split(";")[0],i=atob(e.split(",")[1]),a=[];for(let e=0;e<i.length;e+=t){let r=i.slice(e,e+t),o=Array(r.length);for(let e=0;e<r.length;e++)o[e]=r.charCodeAt(e);let n=new Uint8Array(o);a.push(n)}return new Blob(a,{type:r})},l=e=>new Blob([JSON.stringify(e)],{type:"application/json"}),d=(e,t)=>{let r="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",t+".json"),document.body.appendChild(i),i.click(),i.remove()},m=(e,t)=>{if(!e||0>=e.lastIndexOf("."))return;let r=t?.split("/")[0],i=e.toLowerCase().split(".").pop();return"audio"===r&&"mp3"!==i&&"mpeg"!==i&&"wav"!==i&&"x-wav"===(i=t?.slice(t.indexOf("/")+1))&&(i="wav"),i},s=e=>e<5e5?i.SX.Common_Size_XSmall:e<1e6?i.SX.Common_Size_Small:e<5e6?i.SX.Common_Size_Medium:e<1e7?i.SX.Common_Size_Large:e<2e7?i.SX.Common_Size_XLarge:i.SX.Common_Size_XXLarge,p=async e=>{if("image/svg+xml"===e.type)return{ext:"svg",mime:"image/svg+xml"};let t=await e.arrayBuffer(),{fileTypeFromBuffer:i}=await r.e(1438).then(r.bind(r,1438)),a=await i(t);if(a)return"application/xml"===a.mime&&e.name&&e.name.match(/\.gpx$/i)?{ext:"gpx",mime:"application/gpx+xml"}:{ext:a.ext,mime:a.mime}}},128456:(e,t,r)=>{r.d(t,{Dr:()=>f,Jk:()=>b,Qe:()=>c,Zt:()=>g,b9:()=>T,cT:()=>u,k4:()=>y,ou:()=>h,q_:()=>I});var i=r(816216),a=r(718230),o=r(301972),n=r(724875),l=r(671012),d=r(850415),m=r(771543),s=r(155696),p=r(811579);let c=e=>{let{itemType:t,config:r,isPublicUser:i,isTemplate:s,orgId:c}=e,u=[...r.NEW_ITEM_TYPEKEYWORDS,a.hX.draft,`${m.by.draft}:${r.APP_VERSION}`,o.DD];t===n.z.Collection&&u.push(o.nt),t===n.z.Briefing&&(u.push(o.FW),u.push("alphabriefing")),t===n.z.Frame&&(u.push(o.iz),u.push("alphaframe")),i&&u.push(o.ic),s&&u.push(o.Jv),c&&r.ESRI_MARKETING_ANALYTICS&&r.ESRI_MARKETING_ANALYTICS.orgIds.includes(c)&&u.push(d.AV);let h=t===n.z.Theme?o.Jk:o.tm;return{title:(0,p.x2)({type:t}),tags:[""],typeKeywords:u,type:h,properties:(0,l.c)({thumbnail:["default"]},"replace")}},u=(e,t)=>e&&t&&"undefined"!==e&&"undefined"!==t?`${e} ${t}`:"",h=e=>{let t=(0,i.r8)(),r=(0,i.r8)(),a=(0,i.r8)(),o=(0,i.fG)(),n={root:t,nodes:{[t]:{type:"story",data:{storyTheme:o},config:{coverDate:"first-published",...e.shouldIncludeAuthorCard?{isShowingAuthorCard:!0}:{}},children:[r,a]},[r]:{type:"storycover",data:{type:e.coverType,title:e.title??"",summary:"",byline:u(e.firstName,e.lastName)}},[a]:{type:"navigation",data:{links:[]},config:{isHidden:!0}}},resources:{[o]:{type:"story-theme",data:{themeId:e.baseThemeId,themeBaseVariableOverrides:{},...e.theme&&{themeItemId:e.theme}}}}},l=n.nodes[t].children;if(!l)throw Error("new story created with no children block");if("string"==typeof e.webmap){let t=`r-${e.webmap}`,r=(0,i.r8)();n.resources[t]={type:"webmap",data:{itemId:e.webmap,itemType:"Web Map",type:"default"}},l.push(r),n.nodes[r]={type:"webmap",data:{map:t}}}if("string"==typeof e.webscene){let t=`r-${e.webscene}`,r=(0,i.r8)();n.resources[t]={type:"webmap",data:{itemId:e.webscene,itemType:"Web Scene",type:"default"}},l.push(r),n.nodes[r]={type:"webmap",data:{map:t}}}!e.isTemplate&&(0,p.fO)(e.template)&&v(e.template,a,n);let d=(0,i.r8)();return l.push(d),n.nodes[d]={type:"credits"},n},y=e=>{let t=(0,i.r8)(),r=(0,i.fG)(),a=(0,i.r8)(),o=(0,i.r8)(),n=(0,i.r8)(),l={type:"story-theme",data:{themeId:e.baseThemeId,themeBaseVariableOverrides:{},...e.theme&&{themeItemId:e.theme}}},d={root:t,nodes:{[t]:{type:"frame",data:{storyTheme:r,viewerBackground:"themed"},children:[a]},[a]:{type:"frame-ui",children:[o]},[o]:{type:"frame-slide",data:{layout:"cover"},children:[n]},[n]:{type:"storycover",data:{type:"full",title:"",summary:"",byline:u(e.firstName,e.lastName),titlePanelVerticalPosition:"bottom",titlePanelHorizontalPosition:"start",titlePanelStyle:"themed",titlePanelSize:"large"}}},resources:{[r]:l}};if(!d.nodes[t].children)throw Error("new frame created with no children block");return d},f=e=>{let t=(0,i.r8)(),r=(0,i.r8)(),a=(0,i.r8)(),o=(0,i.r8)(),n=(0,i.fG)(),l={type:"story-theme",data:{themeId:e.baseThemeId,themeBaseVariableOverrides:{},...e.theme&&{themeItemId:e.theme}}};return{root:t,nodes:{[t]:{type:"collection",data:{storyTheme:n},children:[r]},[r]:{type:"collection-ui",data:{items:[]},children:[a,o]},[a]:{type:"collection-cover",data:{title:e.title??"",summary:"",byline:u(e.firstName,e.lastName),type:"tiles"}},[o]:{type:"collection-nav",data:{type:"compact"}}},resources:{[n]:l}}},b=e=>{let t=(0,i.r8)(),r=(0,i.fG)(),a=(0,i.r8)(),o=(0,i.r8)(),n=(0,i.r8)(),l={type:"story-theme",data:{themeId:e.baseThemeId,themeBaseVariableOverrides:{},...e.theme&&{themeItemId:e.theme}}},d={root:t,nodes:{[t]:{type:"briefing",data:{storyTheme:r},children:[a]},[a]:{type:"briefing-ui",children:[o]},[o]:{type:"briefing-slide",data:{layout:"cover"},children:[n]},[n]:{type:"storycover",data:{type:"sidebyside",title:"",summary:"",byline:u(e.firstName,e.lastName),titlePanelHorizontalPosition:"start"}}},resources:{[r]:l}};if(!d.nodes[t].children)throw Error("new briefing created with no children block");return d},g=e=>!e||/^(StoryMap|StoryMapCollection|Theme|StoryMapBriefing) \d{10,15}$/.test(e),T=e=>`${e}${s.QU}`,I=async e=>{let t=`${location.origin}${T(e)}`,r=await fetch(t);return await r.blob()},v=(e,t,r)=>{if(!r.nodes[r.root].children)throw Error("Could not insert template nodes, root node does not have children.");let a=(0,i.r8)(),o=r.nodes[r.root].children.indexOf(t)+1;if(r.nodes[r.root].children.splice(o,0,a),e.startsWith("sidecar")){let t=(0,i.r8)();r.nodes[a]={type:"immersive",data:{type:"sidecar",subtype:"sidecar-floating"===e?"floating-panel":"docked-panel",narrativePanelPosition:"start",narrativePanelSize:"small"},children:[t]};let o=(0,i.r8)();r.nodes[t]={type:"immersive-slide",data:{transition:"fade"},children:[o]},r.nodes[o]={type:"immersive-narrative-panel",data:{panelStyle:"themed",position:"start",size:"small"}}}else if(e.startsWith("guided-tour")||e.startsWith("explorer")){let t=e.startsWith("guided-tour");r.nodes[a]={type:"tour",data:{type:t?"guided-tour":"explorer",subtype:t?"guided-tour-media"===e?"media-focused":"map-focused":"explorer-grid"===e?"grid":"list"}}}}},155696:(e,t,r)=>{r.d(t,{HY:()=>i,QU:()=>a,lI:()=>o});let i=["sidecar","sidecar-floating","sidecar-docked","guided-tour","guided-tour-media","guided-tour-map","explorer","explorer-grid","explorer-list"],a="/static/images/item-default-thumbnails/item.jpg";var o=function(e){return e.DRAFT="smdupdraft",e.PUBLISHED="smduppublished",e.TO_TEMPLATE="smduptotemplate",e.FROM_TEMPLATE="smdupfromtemplate",e}({})},771543:(e,t,r)=>{r.d(t,{O2:()=>o,Wi:()=>n,by:()=>i,cC:()=>a,f7:()=>l});var i=function(e){return e.published="smversionpublished",e.draft="smversiondraft",e}({}),a=function(e){return e.publishedDate="smpublisheddate",e.firstPublishedDate="smfirstpublisheddate",e}({}),o=function(e){return e.Code="code",e.Image="image",e.Image360="image360",e.Video="video",e.ImageOrVideo="image-or-video",e.Audio="audio",e.Embed="embed",e.ArcGISAppEmbed="arcgis-app-embed",e.Map="map",e.WebMap="webmap",e.ExpressMap="expressmap",e.MobilePackage="mobile-package",e.ThematicMap="thematic-map",e.ReadyToUseMap="ready-to-use-map",e.ActivityMap="activity-map",e.Tour="tour",e.Gallery="gallery",e.Table="table",e.Sidecar="sidecar",e.Swipe="swipe",e.Timeline="timeline",e.Custom="custom",e.Globe="globe",e.Terrain="terrain",e.ImageEditor="imageEditor",e.Viewer3D="viewer3D",e.Charting="charting",e.ExpressMapping="expressMapping",e.BinVisualization="binVisualization",e.Template="template",e.File="file-item",e.GeoData="geo-data",e.Chart="chart",e.Infographic="infographic",e}({}),n=function(e){return e[e.Full=1920]="Full",e[e.Wide=1200]="Wide",e[e.Standard=820]="Standard",e}({});function l(e){return"root"in e}},811579:(e,t,r)=>{r.d(t,{BT:()=>v,Oc:()=>c,U8:()=>T,Wx:()=>f,Z3:()=>h,ZL:()=>I,eq:()=>b,fO:()=>y,n6:()=>u,x2:()=>p});var i=r(724875),a=r(111970),o=r(718230),n=r(95206),l=r(850415),d=r(695807),m=r(488310),s=r(155696);let p=({type:e,dateStamp:t})=>{let r=1e3*Math.round(("number"==typeof t?t:t?.getTime()||Date.now())/1e3);return`${({[i.z.Collection]:"StoryMapCollection",[i.z.Story]:"StoryMap",[i.z.Frame]:"StoryMapFrame",[i.z.Briefing]:"StoryMapBriefing",[i.z.Theme]:"Theme"})[e]} ${r}`},c=e=>{let t=(0,a.EN)(e);return t===i.z.Collection?o.jH.Collection:t===i.z.Briefing?o.jH.Briefing:t===i.z.Frame?o.jH.Frame:void 0},u=e=>{if(e){if(e===i.z.Briefing)return o.jH.Briefing;if(e===i.z.Collection)return o.jH.Collection;if(e===i.z.Frame)return o.jH.Frame}},h=(e,t)=>(0,a.EN)(e)===t,y=e=>!!e&&s.HY.includes(e),f=async(e,t)=>{let r=await t?.getUser();if(r?.groups){for(let t of r.groups)if(t.capabilities.includes("updateitemcontrol")&&e.groups?.includes(t.id))return!0}return!1},b=async(e,t)=>{if(e.type===i.z.Collection&&t.items){let{convertToNewCollectionsDataSchema:i}=await r.e(49957).then(r.bind(r,149957));return await i(t,e.portalHost,e.config?.COLLECTION_ITEM_LIMIT||l.oZ,e.authManager)}if(e.type===i.z.Frame){let{nodes:i,root:a}=t,{children:o}=i[a],l=i[o[0]],d=i[l.children[0]];if(d?.type==="timeline-slide"){let{convertToNewFrameTimelineDataSchema:i}=await r.e(19258).then(r.bind(r,619258));return n.A.trackEvent(n.A.Category.Frame,n.A.Action.Frame_ConvertFrameTimeline,e.itemId),i(t)}if(d?.type==="journey-place"&&"journey-slide"===i[d.children[0]].type){let{convertToNewFrameJourneyDataSchema:i}=await r.e(36319).then(r.bind(r,136319));return n.A.trackEvent(n.A.Category.Frame,n.A.Action.Frame_ConvertFrameJourney,e.itemId),i(t)}}return e.type===i.z.Theme&&((0,m.le)(t.variables.titleFontId)&&(t.variables.titleFontId=d.H7[t.variables.titleFontId]),(0,m.le)(t.variables.bodyFontId)&&(t.variables.bodyFontId=d.H7[t.variables.bodyFontId])),t},g={StoryMap:"component.story.emptyTitle","SMX Item":"component.story.emptyTitle",[i.z.Story]:"component.story.emptyTitle",[i.z.Briefing]:"component.briefing.emptyTitle",[i.z.Collection]:"component.collections.emptyTitle",[i.z.Frame]:"component.frame.emptyTitle","StoryMap Theme":"component.theme.emptyTheme","SMX Theme":"component.theme.emptyTheme",[i.z.Theme]:"component.theme.emptyTheme",template:"component.template.emptyTitle"},T=(e,t)=>g[t?"template":e],I=e=>e.itemSubtype?g[e.itemSubtype]:g[e.isTemplate?"template":e.itemType]||"builder.common.untitled";function v(e,t){let r=new Set([]);return e.tags?.includes(s.lI.FROM_TEMPLATE)&&r.add("from-template"),e.tags?.includes(s.lI.TO_TEMPLATE)&&r.add("to-template"),e.tags?.includes(s.lI.PUBLISHED)&&r.add("published"),!t&&e.tags?.includes(s.lI.DRAFT)&&r.add("draft"),t&&r.add("published"),0===r.size&&(r=new Set(["draft"])),r}}}]);